<kendo-pdf-export _ngcontent-uvf-c168="" papersize="A4" margin="2cm" id="div-book-content" class="col-12 col-sm-10 offset-0 div-book-content" uipath_custom_id="10"><div><app-page-content _ngcontent-uvf-c168="" _nghost-uvf-c166="" class="font-size-14 font-size-sm-20"><div _ngcontent-uvf-c166="" class="mainContent mt-4"><div _ngcontent-uvf-c166="" id="bookContent" class="bookContent"><div _ngcontent-uvf-c166="" id="content"><div class="sect1" style="abcpdf-tag-visible: true" id="AU_da1dd9a3-d031-4306-96b6-30a391acbfca" uri="ImagesUri_../download/5c180f28-f752-47db-98e8-8656c84b148d/images/">
      <h1 class="title">Architectures de services</h1>
      <p class="defaut">Toutes les sections précédentes
de ce chapitre d’introduction ont servi à positionner Docker
dans le paysage informatique, à expliquer sur quoi il se
basait, son mode de fonctionnement et son écosystème.
Dans la présente section se pose la question du pourquoi. À quoi
sert Docker, finalement&nbsp;? Pourquoi cette capacité d’économiser
de la ressource, de mettre en commun des couches et d’étanchéifier
des conteneurs légers est-elle si importante en pratique&nbsp;?
Bref, quel est ce besoin pratique fort qui a rendu Docker indispensable&nbsp;?</p>
      <p class="defaut">Il y a de nombreuses raisons à l’explosion
de l’utilisation de Docker dès ses premières
années, puis à son positionnement comme un standard
de facto plus récemment, mais la plupart de ces raisons
se regroupent autour du fait qu’elles participent à la
mise en œuvre des architectures de services, longtemps
complexes à déployer et désormais une
réalité en partie grâce à Docker.</p>
      <div class="sect2" id="refTitle0">
        <h2 class="title">1. Historique des architectures de services</h2>
        <div class="sect3" id="refTitle1">
          <h3 class="title">a. Principes</h3>
          <p class="defaut">La complexification des SI a mis au jour deux
principes fondamentaux.</p>
          <p class="defaut">Le premier est que la valeur d’un SI réside
plus dans ses interactions que dans ses applicatifs.&nbsp;Une
application de caisse enregistreuse ne sert pas à grand-chose
si elle n’est pas reliée à la comptabilité.
Une application de gestion de paie voit son intérêt
singulièrement limité si elle ne peut pas envoyer
des demandes de transferts bancaires. Un logiciel de conception
assistée par ordinateur est obsolète s’il ne peut
pas être associé&nbsp;aux gammes de fabrication
par les machines à commande numérique.</p>
          <p class="defaut">Le second principe - qui n’est pas
lié qu’à l’informatique - est qu’il est
essentiel de découper&nbsp;pour mieux régner. À partir
d’une certaine complexité, il est illusoire de vouloir
gérer un système avec une seule application, et
la spécialisation amène obligatoirement à scinder
les responsabilités.</p>
          <p class="defaut">Le cheval de bataille de l’architecture des
SI a été de pousser ce second principe au maximum,
avec différentes approches sur les vingt ou trente dernières
années, qui ont connu plus ou moins de succès.
Nous ne citerons pas les premières méthodes artisanales
d’échange de données directement au niveau
des systèmes de gestion de base de données, avec
dans leurs dernières évolutions la mise en œuvre
d’ETL. Il s’agissait des ancêtres des
architectures basées sur des services, à l’époque
où une interopérabilité des données
seulement semblait une approche suffisante. Le couplage fort que
ces méthodes&nbsp;imposaient a conduit à leur
disparition progressive.</p>
        </div>
        <div class="sect3" id="refTitle2">
          <h3 class="title">b. Approche EAI</h3>
          <p class="defaut">L’EAI (<span class="italic">Enterprise Application Integration</span>)
fut un temps à la mode, avant qu’on se rende compte que
sa dépendance à un unique point central posait
des problèmes de performances en charge et de fiabilité.
On parle alors de syndrome SPOF (<span class="italic">Single Point Of Failure</span>)
pour décrire ce danger de la dépendance à un
service central qui fait l’interprète entre tous les autres.</p>
        </div>
        <div class="sect3" id="refTitle3">
          <h3 class="title">c. Approche SOA</h3>
          <p class="defaut">Les approches SOA (<span class="italic">Service-Oriented Architecture</span>)
ont eu pour but de lever ce problème, en s’appuyant sur
des middlewares distribués et non centralisés,
typiquement les ESB (<span class="italic">Enterprise Service Bus</span>)
pour le transport, et des normes et standards issus de l’Internet
pour les grammaires qui devaient être comprises de tous
les participants au "bus de services".</p>
          <p class="defaut">Ces approches ont pêché par
complexité (utilisation massive de SOAP et des normes WS-*,
ajoutant à la verbosité - et donc la
lourdeur - des services web), mais aussi car elles se sont
basées sur des normes qui étaient purement techniques.
Il est évidemment utile de s’entendre sur un échange
au format XML, mais si cet échange n’est pas contractualisé par
un XMLSchema établi de concert en amont, l’urbanisation
du SI ne peut pas prendre. Il faut se mettre d’accord sur une définition
conceptuelle des entités métier qui seront véhiculées,
de façon à garantir que les services arriveront à se
comprendre. Le formalisme technique utilisé pour la représentation
et le protocole utilisé pour les échanges sont
finalement peu importants. Des outils de médiation efficaces, basés
sur le standard EIP (<span class="italic">Enterprise Integration Patterns</span>),
existent désormais et prennent en charge efficacement cette
partie du problème.</p>
        </div>
        <div class="sect3" id="refTitle4">
          <h3 class="title">d. Microservices<var style="display:none"> Microservices</var></h3>
          <p class="defaut">Les architectures SOA pourraient avoir dans
les prochaines années une seconde chance, et ce suite à la
conjonction de deux évolutions des techniques. La première
est que les normes métier commencent à émerger
dans l’informatique, et les échanges au niveau mondial
déteignent sur les protocoles internes aux entreprises.
Les assurances ont normalisé leurs échanges avec
ACORD (<span class="italic">Association for Cooperative Operations Research&nbsp;and Development</span>),
les voyagistes par OTA (<span class="italic">OpenTravel Alliance</span>),
les opérateurs de téléphonie par eTOM
(<span class="italic">Enhanced Telecom Operations Map</span>).
La seconde est que les approches REST (<span class="italic">REpresentational State Transfer</span>),
plus simples que SOA, permettent une plus grande diffusion des services
sous forme d’API réutilisables aisément par les techniciens.</p>
          <p class="defaut">Couplé avec une décomposition
encore plus forte des différentes responsabilités,
c’est ce mélange qui a lancé le mouvement des
micro-services. Les architectures de micro-services consistent à utiliser
cette normalisation et cette simplification pour pousser le curseur
de la décomposition encore plus loin, en établissant
le principe de mise en œuvre d’une application pour un
service, entre les applications et les services.</p>
          <p class="defaut">Récemment, les apports des webhooks
comme mécanisme simple et standard d’interopérabilité&nbsp;entre
différents services en ligne ainsi que la meilleure utilisation
des mécanismes&nbsp;du web ont permis de mettre en œuvre
des approches qualifiées de WOA (<span class="italic">Web Oriented Architectures</span>).</p>
        </div>
        <div class="sect3" id="refTitle5">
          <h3 class="title">e. Lien à l’urbanisation des SI</h3>
          <p class="defaut">Tous ces efforts d’architecture des SI pourraient
paraître démesurés si on ne les replace
pas dans le contexte de l’urbanisation des SI. L’approche technique de
SOA/WOA et des micro-services se justifie en effet par
leur effet sur la souplesse du SI dans son ensemble et sa capacité renforcée à s’aligner
au plus vite sur les changements du métier qui sous-tend
le SI (changement de processus, d’organisation, de personnes en
charge des traitements, fusion et acquisition d’entités,
etc.).</p>
          <p class="defaut">L’urbanisation du SI, c’est-à-dire
la possibilité de tirer de la valeur de l’informatique
de manière continue, est bien le grand objectif derrière
toutes ces étapes de structuration, dont Docker est un
des rouages. Son apport est d’ailleurs tel qu’on pourrait presque
le considérer dans certains cas comme l’huile qui rend les
rouages (les services, dans notre métaphore) plus efficaces.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle6">
        <h2 class="title">2. Architecture de microservices<var style="display:none"> Microservices</var></h2>
        <div class="sect3" id="refTitle7">
          <h3 class="title">a. Principe</h3>
          <p class="defaut">L’exemple d’une application trois-tiers montré plus
haut peut être repris et découpé à la
mode micro-services, en faisant apparaître les différentes
responsabilités (il s’agit du terme consacré dans
le jargon de l’urbaniste) qu’elle embarque.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/01EP16.png" title="images/01EP16.png" src="IMAGES/01EP16.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmPpRGULy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Il ne s’agit bien sûr que d’un exemple.
Les responsabilités dépendent d’un domaine métier à l’autre.
L’essentiel est de se mettre d’accord sur un vocabulaire et des
services communs, qui ne varient pas d’une application à l’autre.</p>
          <p class="defaut">La découpe d’un SI dans son ensemble
(il est essentiel de s’extraire de la vue applicative) en services
autonomes et le plus faiblement couplés possible est un
art, et justifie d’ailleurs la présence d’experts en urbanisation
parmi les équipes de développement, en soutien
des architectes logiciels. Le premier pas dans cette démarche
est l’établissement d’un plan d’occupation
des sols selon les quatre couches consacrées, à savoir
les processus, les fonctions, les applicatifs et l’infrastructure
(on parle du "diagramme quatre strates" du système d’information),
schématisé ci-dessous.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/01EP17.png" title="images/01EP17.png" src="IMAGES/01EP17.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmPpRGULy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Ce type de schéma est parfois
qualifié également de "diagramme CIGREF", le Club
Informatique&nbsp;des Grandes Entreprises Françaises étant
une des premières entités à l’avoir utilisé.</p>
            </div>
          </div>
        </div>
        <div class="sect3" id="refTitle8">
          <h3 class="title">b. Avantages</h3>
          <p class="defaut">Les avantages associés à des
architectures en micro-services sont énormes. L’alignement
du SI aux métiers, la souplesse évolutive apportée
et le fait de pouvoir - enfin - réellement
remplacer une pièce du SI par une autre avec des impacts
limités sont des apports tels qu’ils expliquent à eux
seuls pourquoi, malgré des dizaines d’années d’échecs
sur les approches EAI et SOA, les architectes s’entêtent à creuser
dans le sens des architectures de services.</p>
          <p class="defaut">Il est indéniable que ces facteurs
d’amélioration des SI sont, une fois maîtrisés, des
avantages concurrentiels énormes.</p>
          <p class="defaut">L’alignement du SI sur les métiers
consiste à refléter dans son organisation informatique
(réseau, machines, mais aussi logiciels et organigramme)
le fonctionnement d’une entreprise ou n’importe quelle autre entité en
charge du SI. Ainsi, les changements opérationnels se traduisent
facilement en modifications de l’informatique. Cet alignement était
particulièrement à la mode dans les années
2000, lorsque les opérations de fusion/acquisition
entre startups étaient très fréquentes.<var style="display:none"> Alignement</var></p>
          <p class="defaut">Pour prendre un exemple, imaginons qu’une
entreprise A achète une entreprise B. Si le système
informatisé de paie de B nécessitait la saisie
de toutes les personnes directement dans le logiciel, et que A n’utilise
pas le même, il va s’ensuivre un traitement manuel pour
ajouter tous les employés de B dans le système
de paie de A. Et ce traitement devra être recommencé pour
toutes les autres applications en commun (par exemple la gestion
des badges), ralentissant d’autant le processus de fusion humaine
des compétences, pour des raisons bassement informatiques.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/01EP18.png" title="images/01EP18.png" src="IMAGES/01EP18.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmPpRGULy7jYiAs%3d"></div>
          </div>
          <p class="defaut">À l’inverse, si les SI de A et de
B étaient bien alignés avec le fonctionnement des
entreprises, il serait logique que chacun d’eux possède
un annuaire d’entreprise (typiquement LDAP ou <span class="italic">Lightweight Directory Access Protocol</span>)
et que les systèmes de paie soient tous les deux branchés
sur l’annuaire respectif, en utilisant le protocole LDAP. Dans ce
second cas, la fusion sera particulièrement aisée,
car B va simplement procéder à un export de ses
employés (au format standard LDIF, ou LDAP <span class="italic">Data Interchange Format</span>, aisément
compris par tous les annuaires LDAP) et A va incorporer ces personnes
dans son annuaire, par un import du fichier LDIF. Elles apparaîtront
alors automatiquement dans la paie, mais aussi dans tous les autres
services de A branchés sur l’annuaire des personnels.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/01EP19.png" title="images/01EP19.png" src="IMAGES/01EP19.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmPpRGULy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Dans notre exemple, nous n’avons montré que
deux applications, mais il est courant dans les SI industriels que
ce nombre se chiffre en centaines, voire dans les cas extrêmes&nbsp;en
milliers. Il est alors indispensable de confier la bonne responsabilité au
bon service&nbsp;: le rôle du service logiciel de paie
est bien d’émettre des mandats de salaire, pas de gérer
qui est inscrit parmi les employés de la société.</p>
          <p class="defaut">L’approche urbanisée consistant à confier
la bonne responsabilité au bon service, et si possible à réduire à une
pour un cette répartition, diminue ainsi la force du couplage
des applications les unes aux autres, et facilite au final l’évolution
progressive du SI dans le temps. Dans un SI correctement urbanisé,
on ne parle plus jamais de "Big Bang". Il n’est pas anodin que l’État,
en charge d’un SI extrêmement ramifié et complexe,
recommande lui-même à ses organismes d’urbaniser
les architectures des SI (voir le Cadre commun d’urbanisation de la
Direction interministérielle du numérique, des
systèmes d’information et de communication).</p>
          <p class="defaut">D’une certaine manière, les architectures
de micro-services sont en train d’atteindre le Graal de l’informatique, à savoir
la réutilisabilité, promise depuis des dizaines
d’années successivement par les routines, les librairies,
les composants, les composants distribués, les services
web, mais jamais atteinte car envisagée jusqu’à maintenant
sous le prisme uniquement technique. L’urbanisation règle
une fois pour toutes le problème en le prenant du seul point
de vue qui prévale à long terme, à savoir
celui de l’utilisateur de l’API ou du service. Elle impose toutefois
une approche du découpage des concepts informatiques radicalement
différente de celle massivement utilisée de nos
jours et qui est liée à des critères
techniques. L’alignement passe par un découpage des
fonctions informatiques piloté par le métier, à la
manière de ce que prône Eric Evans dans son approche
Domain-Driven Design, par exemple.</p>
        </div>
        <div class="sect3" id="refTitle9">
          <h3 class="title">c. Inconvénients</h3>
          <p class="defaut">Avec de tels avantages, il est légitime
de se demander pourquoi tous les SI ne sont pas déjà construits
avec des approches urbanisées, d’autant qu’aucune difficulté technique
ne l’empêchait.</p>
          <p class="defaut">La raison principale tient dans le coût.</p>
          <p class="defaut">Il y a bien sûr le coût
des outils soutenant ces architectures. Les middlewares ont longtemps&nbsp;coûté cher.
Les EAI appâtaient le client par un faible coût
initial, mais chaque connecteur additionnel augmentait le coût
par la suite. Les approches ESB nécessitaient&nbsp;une
mise en place coûteuse et les outils propriétaires
représentaient un fort investissement.&nbsp;L’avènement
des ESB open source, au premier rang desquels la solution&nbsp;de
la fondation Apache (ActiveMQ pour le Message-Oriented Middleware,
Camel&nbsp;pour le framework de médiation compatible
Enterprise Integration Patterns, Karaf pour le chargement dynamique)
a changé la donne, en ouvrant la porte des ESB aux PME.</p>
          <p class="defaut">Toutefois, la vraie réduction du
coût des architectures de services est venue du développement
de normes internationales auxquelles de plus en plus de logiciels
adhèrent. Dans l’exemple plus haut, il est évident
que la mise en place d’un annuaire centralisé est un investissement,
justifiable par un nombre élevé d’applications
l’utilisant. Mais lorsque ces annuaires LDAP existent déjà en open
source, et surtout quand presque tous les logiciels de gestion sont
capables de se brancher sur n’importe lequel de ces annuaires justement
grâce à la norme LDAP, le surcoût est
quasi inexistant. Le surcroît&nbsp;d’analyse étant
déjà pris en charge, il reste éventuellement
le surcoût d’utiliser plusieurs machines différentes
si on souhaite étanchéifier correctement les services.</p>
          <p class="defaut">Et c’est là que nous retombons sur
la principale limite - jusqu’à maintenant - des
approches&nbsp;de micro-services&nbsp;: pour ne pas remplacer
du couplage métier par du couplage technique, il convient
de disposer ces petits services sur des environnements étanches.</p>
          <p class="defaut">Or, les architectures à micro-services
déploient souvent des dizaines, voire quelques centaines
de services, et encore plus d’environnements séparés
lorsqu’on souhaite gérer&nbsp;finement la charge de
chacun.</p>
          <p class="defaut">Il est évidemment inenvisageable
de dédier une machine virtuelle à chacun de ces
micro-services. Et c’est là que nous revenons à Docker,
car lui va nous permettre de mettre en œuvre ce genre de
micro-découpage en rendant tout à fait supportable
l’augmentation&nbsp;de ressources nécessaires.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle10">
        <h2 class="title">3. Apport de Docker</h2>
        <p class="defaut">L’apport de Docker aux architectures de micro-services
est absolument fondamental. Il n’est pas déraisonnable
de prétendre que ces dernières n’auraient sûrement
jamais été mises en œuvre, ou en tout
cas restreintes à des déploiements de niche, si
les technologies de conteneurs n’avaient pas été suffisamment
simplifiées. Au-delà du fait que Docker a vulgarisé l’utilisation
des conteneurs Linux (et est à l’origine de leur
existence sous Windows), on peut lui attribuer une grande responsabilité dans
le fait que les architectures de services sont en train de devenir
une réalité.</p>
        <p class="defaut">En fait, la technique et la méthode
sont tellement liées qu’il est difficile de dire si les
architectures de micro-services ont fait émerger le besoin
d’une technologie comme Docker, ou si la mise à disposition
de Docker a participé à l’émergence des
architectures à micro-services.</p>
        <p class="defaut">Sans Docker, les considérations de
coût empêcheraient bon nombre de décompositions
en services qui auraient pourtant du sens en termes de découplage de
responsabilité. S’il fallait rajouter une machine virtuelle
avec tout son système d’exploitation, et parfois les licences
associées, à chaque fois qu’on coupe un service
en deux, les architectes&nbsp;urbanistes auraient tôt
fait de se limiter, et l’assouplissement du SI serait incomplet.
Or, comme nous l’avons vu, l’apport de valeur de l’informatique
passe désormais&nbsp;par un alignement rapide du SI avec
le métier, et cette rapidité dépend du
niveau de découplage des services.</p>
        <p class="defaut">Ce n’est pas un hasard si des sociétés
comme Netflix, à la pointe des architectures de micro-services
et ayant réussi une croissance extrêmement rapide, utilisent
massivement Docker.</p>
      </div>
      <div class="sect2" id="refTitle11">
        <h2 class="title">4. Fil conducteur</h2>
        <p class="defaut">Après cette longue introduction à Docker
et à ses usages, nous allons dans les chapitres suivants
rentrer en détail dans les méthodes de mise en œuvre.
Pour cela, nous nous servirons de l’exemple d’architecture de micro-services
comme d’un fil rouge. C’est cette architecture que nous modéliserons
sous forme de conteneurs, dont nous diffuserons les images, que
nous intégrerons dans l’ALM (<span class="italic">Application Lifecycle Management</span>),
que nous déploierons dans un cluster, et que nous administrerons
grâce à l’écosystème Docker.</p>
        <p class="defaut">Non seulement cette approche par l’exemple
facilitera la compréhension des fonctionnalités
de Docker, en montrant pour quelles raisons elles existent, mais
en plus elle permettra de situer Docker dans le mouvement de fond
des systèmes informatiques qui s’opère en ce moment
même, et dont il est un des acteurs principaux.</p>
        <p class="page"></p>
      </div>
    </div></div></div></div></app-page-content><!----><!----><!----></div></kendo-pdf-export>