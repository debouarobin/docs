<kendo-pdf-export _ngcontent-uvf-c168="" papersize="A4" margin="2cm" id="div-book-content" class="col-12 col-sm-10 offset-0 div-book-content" uipath_custom_id="10"><div><app-page-content _ngcontent-uvf-c168="" _nghost-uvf-c166="" class="font-size-14 font-size-sm-20"><div _ngcontent-uvf-c166="" class="mainContent mt-4"><div _ngcontent-uvf-c166="" id="bookContent" class="bookContent"><div _ngcontent-uvf-c166="" id="content"><div class="sect1" style="abcpdf-tag-visible: true" id="AU_9ff5728d-5d0e-4370-8a4a-09e8aec7dcc6" uri="ImagesUri_../download/5c180f28-f752-47db-98e8-8656c84b148d/images/">
      <h1 class="title">Installation de Docker<var style="display:none"> Installation</var></h1>
      <p class="defaut">Le lecteur disposant désormais d’une
machine, ou bien locale ou bien dans le cloud en utilisant une des
méthodes décrites en détail dans la précédente
section, nous pouvons&nbsp;désormais passer à l’installation
de la plateforme Docker elle-même.</p>
      <div class="note">
        <div class="remarkimg"><span class="icon-note"></span></div>
        <div class="divinline">
          <p class="remarque">La section précédente
peut paraître trop détaillée s’il s’agissait
juste de guider un utilisateur pour disposer d’une machine de test,
mais outre que certains lecteurs sont débutants&nbsp;et
auront intérêt à être guidés
précisément dans leurs premiers pas, l’utilisation
de Docker en cluster, qui sera vue plus loin, nécessite d’avoir
une bonne connaissance&nbsp;des méthodes et vocabulaire
de déploiement de machines dans le cloud, car il faut pouvoir
ensuite les automatiser, de façon à viser une élasticité complète
de l’infrastructure&nbsp;mise en place.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle0">
        <h2 class="title">1. Installation de Docker sur Linux</h2>
        <div class="sect3" id="refTitle1">
          <h3 class="title">a. Prérequis<var style="display:none"> Prérequis</var></h3>
          <p class="defaut">Bien que Docker se base très largement
sur des fonctionnalités du système, il s’agit
surtout de modules de bas niveau et donc pas à proprement
parler de dépendances. En termes de prérequis,
il suffit sous Linux d’un noyau 3.10 au moins (sous Windows, d’une
installation de quelques années maximum, mais nous y reviendrons
plus loin).</p>
          <p class="defaut">Dans tous les cas, il est nécessaire
de disposer d’un système d’exploitation 64 bits.</p>
          <p class="defaut">En termes de dépendances logicielles,
Docker ne demande que des modules qui sont largement déployés
désormais, comme <span class="courier11">ca-certificates</span> par exemple.
Nous partons&nbsp;du principe que le lecteur utilise un système
d’exploitation récent et que les installations par une
simple ligne de commande suffiront. Ainsi, nous reprenons ci-dessous
quelques-unes des méthodes, à titre uniquement
informatif. Les systèmes étant tellement disparates
et les modes d’installation rajoutant de l’hétérogénéité,
il serait illusoire de viser l’exhaustivité, et une liste
complète n’apporterait rien au lecteur.&nbsp;Nous renvoyons
donc sur la documentation et les communautés pour trouver
la bonne façon de faire en fonction du contexte, sachant
que cette opération ne pose globalement plus de problème.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Certains systèmes Linux récents
fournissent même la commande à entrer pour installer
le logiciel lorsqu’un utilisateur essaie de l’exécuter.
Entrez simplement <span class="courier11">docker</span> sur une
invite&nbsp;de commandes et validez pour voir si votre système
offre cette assistance.</p>
            </div>
          </div>
        </div>
        <div class="sect3" id="refTitle2">
          <h3 class="title">b. Gestionnaires de paquets<var style="display:none"> Paquet</var></h3>
          <p class="defaut">Le plus simple lorsqu’on parle d’installation
sous Linux est d’utiliser les gestionnaires de paquets intégrés
dans les distributions. Ainsi, dans les distributions utilisant
Aptitude,&nbsp;on pourra utiliser cette commande générique proposée
par exemple par Ubuntu Focal&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql">apt <span class="hljs-keyword">install</span> docker.io</code></pre>
          <p class="defaut">La documentation du site Docker (accessible
sur <a class="url" href="https://docs.docker.com/engine/install/" target="_blank">https://docs.docker.com/engine/install/</a>)
est plus précise, avec les lignes suivantes&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql">apt-get <span class="hljs-keyword">update</span>&nbsp;
apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">install</span> docker-ce docker-ce-cli containerd.io</code></pre>
          <p class="defaut">Si Snap est disponible, la commande à lancer
sera la suivante&nbsp;:</p>
          <pre class="literallayout"><code class="hljs sql">snap <span class="hljs-keyword">install</span> docker</code></pre>
          <p class="defaut">Si vous utilisez Yum, la commande est comme
suit&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql">yum <span class="hljs-keyword">install</span> docker-ce docker-ce-cli containerd.io</code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Toutes les commandes montrées
ci-dessus sont bien sûr à précéder
de <span class="courier11">sudo</span> en règle générale,
car il est nécessaire d’avoir des droits administrateurs
pour installer un système comme Docker.</p>
            </div>
          </div>
          <p class="defaut">À nouveau, nous ne nous attardons
pas sur toutes les variantes, syntaxes optionnelles pour choix d’une
version fixe, commandes de mise à jour, commandes de suppression
d’une installation, etc. L’hétérogénéité des
situations est telle qu’il faudrait un livre pour expliquer tous
les cas (et le lecteur ne trouverait dans ce livre que quelques
fractions&nbsp;de contenu utile pour son propre cas).</p>
        </div>
        <div class="sect3" id="refTitle3">
          <h3 class="title">c. Installation par script<var style="display:none"> Script</var></h3>
          <p class="defaut">Une solution de facilité et qui a
le bon goût de regrouper une grande partie de la diversité des
commandes ci-dessus en une seule commande est de lancer le script
d’installation fourni par Docker. Ce script adapte la façon
d’installer Docker en fonction de la distribution utilisée
et permet une installation dans de nombreux cas standards.</p>
          <p class="defaut">Un appel à <a class="url" href="https://get.docker.com" target="_blank">https://get.docker.com</a> pour
la version stable ou à <a class="url" href="https://test.docker.com" target="_blank">https://test.docker.com</a> pour
la version de test permet de télécharger un script
depuis n’importe quel navigateur, script qu’on exécutera
ensuite depuis une ligne de commande.</p>
          <p><span class="bridgehead_niv4">Téléchargement du script
d’installation de Docker</span></p>
          <pre class="programlisting"><code class="hljs javascript">wget -O dockerinstall.sh https:<span class="hljs-comment">//get.docker.com</span></code></pre>
          <p class="defaut">Un coup d’œil au fichier est très
instructif sur les opérations d’installation réalisées
en sous-main, et constitue également une bonne habitude à prendre lorsqu’on
exécute un fichier téléchargé à l’extérieur,
pour de simples raisons de sécurité. L’opération
suivante consiste à lancer le fichier depuis le shell de votre
système d’exploitation.</p>
          <p><span class="bridgehead_niv4">Lancement du script d’installation de
Docker</span></p>
          <pre class="programlisting"><code class="hljs">sh ./dockerinstall.sh</code></pre>
          <p class="defaut">L’installation en elle-même prend
quelques minutes. Comme dans les cas suivants, la commande <span class="courier11">docker version</span> permet de vérifier
qu’elle s’est correctement déroulée.</p>
          <p class="defaut">Une des toutes premières commandes à mettre
en œuvre afin de ne pas avoir à préfixer
par <span class="courier11">sudo</span> les commandes Docker est
la suivante, qui va ajouter votre utilisateur dans le groupe <span class="courier11">docker</span>, lui donnant ainsi les droits
nécessaires.</p>
          <p><span class="bridgehead_niv4">Ajout de l’utilisateur dans le
groupe docker</span></p>
          <pre class="programlisting"><code class="hljs scss">sudo usermod -aG docker <span class="hljs-selector-attr">[identifiant du compte utilisé]</span></code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">En fonction du contexte, il peut être
requis, si cette commande ne fonctionne pas, de créer au
préalable le groupe <span class="courier11">docker</span> à l’aide
de la commande <span class="courier11">groupadd</span>.</p>
            </div>
          </div>
          <p class="defaut">Pour que la commande soit effective, il est
nécessaire de fermer la session utilisateur et de se déconnecter,
ce qui force le recalcul des niveaux d’appartenance aux groupes
du système. Dans quelques rares cas, il peut également être utile
pour que la commande&nbsp;soit prise en compte de redémarrer
le service <span class="courier11">docker</span>.</p>
          <p><span class="bridgehead_niv4">Redémarrer Docker</span></p>
          <pre class="programlisting"><code class="hljs">sudo systemctl restart docker</code></pre>
        </div>
        <div class="sect3" id="refTitle4">
          <h3 class="title">d. Cas particulier de l’installation sur Clear Linux<var style="display:none"> Clear Linux</var></h3>
          <p class="defaut">Dans la seconde édition de ce livre,
c’est la version légère de Linux Core OS qui avait été utilisée
pour montrer les exercices, mais il se trouve que cette distribution
n’est plus supportée par l’éditeur à partir
du 26 mai 2020, au profit de Fedora Core. Comme cette distribution
n’était pas disponible sur le fournisseur de service cloud
Azure utilisé par l’auteur en date d’écriture,
les exemples seront plutôt basés sur une distribution
Clear Linux.</p>
          <p class="defaut">De manière générale,
ce type de distribution est intéressant, car il permet d’avoir
une couche de système d’exploitation extrêmement
légère. Il est bien sûr possible de faire
fonctionner Docker sur une distribution Red&nbsp;Hat ou Ubuntu,
avec une interface graphique et toutes les applications nécessaires à l’utilisateur,
mais cet usage correspond surtout à celui d’un développeur
ayant besoin de réaliser des tests sur des images Docker.&nbsp;Lorsqu’il
s’agit de production, on aura tout intérêt à utiliser
un substrat beaucoup&nbsp;plus allégé pour
Docker, et donc un système d’exploitation avec le strict
minimum&nbsp;pour que Docker s’exécute et pour qu’il
soit possible à un administrateur de superviser ce fonctionnement.
C’est la raison d’être de ces distributions très
légères comme Clear Linux, qui ne contiennent
que les librairies et outils indispensables pour que Docker puisse
s’exécuter dessus.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Attention, ce besoin de légèreté existe également
dans l’autre sens, à savoir pour des images de base qui
serviront de couche fondamentale à des images Docker avec
des applications serveur. Le raisonnement est alors le même, à savoir
qu’il est intéressant de ne disposer que des dépendances
absolument nécessaires à l’exécution
d’un serveur applicatif ou de tout autre mécanisme positionné sur
une image Docker. Toutefois, le résultat est bien sûr
différent car on parle des dépendances de Docker
d’un côté et des dépendances nécessaires à une
application de l’autre. Bien sûr, si on cherche à rester
sur des images à peu près standards, les deux
besoins sont relativement proches et une image CoreOS peut servir
de base légère à une image applicative.
Utiliser une image <span class="courier11">alpine</span> est également
une bonne solution, très légère. Mais
si on cherche vraiment l’optimisation&nbsp;à tout prix,
alors le plus logique sera de créer une image Linux de
base avec uniquement ce qui est nécessaire précisément pour
l’application se basant dessus. Pour cela, plusieurs approches existent&nbsp;: partir
d’une image Docker vide (on parle alors de l’image <span class="courier11">scratch</span>), utiliser des outils comme
Buildah pour ajouter les dépendances, ou bien encore créer
ce qu’on qualifie de microconteneurs avec une application autonome
précompilée comme on peut le faire avec Go.</p>
            </div>
          </div>
          <p class="defaut">De nombreux éditeurs proposent leur
propre approche de l’image de base Linux&nbsp;: CoreOS a été repris
par Red&nbsp;Hat dans son projet Atomic, tandis que RancherLabs
propose l’image RancherOS et Canonical met en avant Ubuntu Core.
Les fournisseurs de cloud ne sont pas en reste et ont un double
intérêt à créer des images de
base légères, car cela améliore non seulement
la performance pour leurs utilisateurs, mais aussi réduit
la consommation de ressources sur leurs plateformes. Amazon met à disposition
BottleRocket, tandis que Google Cloud Platform propose un Container-Optimized
Operating System. Dans le cas de BottleRocket, Amazon met clairement
en avant sur la page de description de la technologie qu’il s’agit
d’un système d’exploitation léger supportant le
moteur Docker et non d’une image de base allégée
pour servir de base à des images Docker, ce qui a l’avantage
de la clarté par rapport à d’autres éditeurs.</p>
          <p class="defaut">Pour en revenir à Clear Linux, lorsque
la machine est prête, il est recommandé de commencer&nbsp;par
réaliser une étape de mise à jour du
système.</p>
          <p><span class="bridgehead_niv4">Mettre à jour le système</span></p>
          <pre class="programlisting"><code class="hljs sql">sudo swupd <span class="hljs-keyword">update</span></code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Attention, il est parfois nécessaire
d’attendre que des mises à jour se fassent lors du premier&nbsp;démarrage
pour pouvoir installer des logiciels additionnels. Dans certains
cas, un reboot sera même nécessaire. Le système
le fera savoir par un message sur l’invite de commandes lors de
la connexion.</p>
            </div>
          </div>
          <p class="defaut">La gestion des paquetages de Clear Linux permet
de déployer Docker en une seule ligne de commande.</p>
          <p><span class="bridgehead_niv4">Installer Docker sous Clear Linux</span></p>
          <pre class="programlisting"><code class="hljs cs">sudo swupd bundle-<span class="hljs-keyword">add</span> cloud-control</code></pre>
          <p class="defaut">Lors du début de l’écriture
de ce livre, le bundle à charger était <span class="courier11">containers-basic</span>, mais il semble que
Clear Linux ait réorganisé les bundles et c’est
désormais <span class="courier11">cloud-control</span> qui
est recommandé lorsqu’on essaie de lancer Docker.</p>
          <p class="defaut">Les deux commandes suivantes sont recommandées,
pour permettre à l’utilisateur de ne pas avoir à préfixer
systématiquement les commandes Docker par <span class="courier11">sudo</span>, et pour faire en sorte que Docker
soit lancé automatiquement lors du démarrage du
système, respectivement&nbsp;:</p>
          <pre class="programlisting"><code class="hljs scss">sudo usermod -aG docker <span class="hljs-selector-attr">[login utilisateur]</span>&nbsp;
sudo systemctl enable docker</code></pre>
          <p class="defaut">Pour faire bonne mesure, et avant de relancer
le système pour vérifier que tout fonctionne bien,
Docker Compose sera également installé (il servira
dans la seconde partie des exercices du présent ouvrage).</p>
          <p><span class="bridgehead_niv4">Installer Docker Compose sous Clear Linux</span></p>
          <pre class="programlisting"><code class="hljs cs">sudo swupd bundle-<span class="hljs-keyword">add</span> docker-compose</code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">De nombreux bundles sont proposés
par Clear Linux, comme on peut le voir sur <a class="url" href="https://clearlinux.org/software" target="_blank">https://clearlinux.org/software</a>,
ce qui permet en une seule ligne de commande de déployer
telle ou telle application ou dépendance. Presque aussi pratique
que de démarrer une image Docker&nbsp;! Au passage,
l’installation de ce paquet déclenche en dépendance
celle du bundle <span class="courier11">containers-basic</span> dont
il était question un peu plus haut.</p>
            </div>
          </div>
          <p class="defaut">Il serait possible de démarrer directement
le moteur Docker ainsi que de sortir uniquement&nbsp;de la session
pour prendre en compte le reste du paramétrage réalisé plus
haut (pour plus de détails, se référer à <a class="url" href="https://docs.01.org/clearlinux/latest/tutorials/docker.html" target="_blank">https://docs.01.org/clearlinux/latest/tutorials/docker.html</a>),
mais le plus simple sur des systèmes aussi légers
est tout simplement de relancer&nbsp;l’ensemble, ce qui permet
d’ailleurs de valider que tout fonctionne bien en automatique.&nbsp;Après
tout, il s’agit de la raison d’être de ces systèmes
allégés que de fonctionner comme des serveurs
légers entièrement autonomes. Comme pour tout
Linux,&nbsp;la commande à lancer pour finir est donc
la suivante&nbsp;:</p>
          <pre class="programlisting"><code class="hljs">sudo reboot</code></pre>
          <p class="defaut">Après redémarrage, ce qui
ne prend que quelques secondes, le système est alors prêt
pour faire fonctionner Docker, et donc entreprendre tous les exercices
qui commencent&nbsp;dès le prochain chapitre.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle5">
        <h2 class="title">2. Le paradoxe Docker sous Windows</h2>
        <div class="sect3" id="refTitle6">
          <h3 class="title">a. Des technologies différentes</h3>
          <p class="defaut">Docker est un produit pensé autour
de technologies du noyau Linux, à savoir les control groups
et les namespaces et dont l’implémentation reste
très dépendante de celui-ci. Les technologies
citées n’existant pas nativement dans le système
d’exploitation Windows, installer Docker sous Windows a
longtemps consisté à simplement faire fonctionner
une machine virtuelle Linux sous Windows et à faire porter à celle-ci
des conteneurs Linux. C’est ce qui était réalisé par
l’outil boot2docker, packagé ensuite&nbsp;sous
le nom de Docker Toolbox, sous Windows et Mac OS X. C’est également
de cette façon qu’a longtemps fonctionné la version
Windows de Docker, en utilisant des fonctionnalités de
la couche de virtualisation Hyper-V. Bien sûr, cette approche
allait complètement à l’encontre des objectifs
de légèreté de Docker et ne pouvait pas être
utilisée en production. Mais sur des machines de développeurs,
elle permettait de rapidement mettre en œuvre des dépendances
de services ou même de monter un conteneur pour test d’un
code réalisé sur une machine Windows, mais ciblé pour
un déploiement Linux (ce qui reste courant).<var style="display:none"> Docker Toolbox</var></p>
          <p class="defaut">La normalisation de l’API Docker
et de la composition des images par l’Open Container Initiative
a toutefois ouvert la porte à une implémentation
Windows native et qui serait largement compatible avec la référence
sous Linux. Il restait toutefois le plus dur du chemin à faire, à savoir
trouver comment implémenter des fonctionnalités
aussi&nbsp;bas niveau dans Windows tout en limitant les impacts.<var style="display:none"> Open Container Initiative</var></p>
          <p class="defaut">Les équipes de développement
système de Microsoft ont à un moment pensé utiliser
la technologie Drawbridge d’isolation de processus d’Azure,
mais celle-ci a finalement été abandonnée
au profit de technologies plus anciennes, mais mieux adaptées
au besoin,&nbsp;à savoir Windows Job Object (permettant
de gérer des groupes de ressources) et Server Silos (technologie
d’isolation de systèmes de fichiers, registres,
etc.).<var style="display:none"> Drawbridge</var><var style="display:none"> Windows Job Object</var></p>
          <p class="defaut">Un article de Taylor Brown paru dans le numéro
de MSDN Magazine d’avril 2017 explique&nbsp;en détail
comment l’implémentation a été réalisée,
mais il est peut-être plus important de savoir que l’implémentation
Windows de Docker a été réalisée
par Microsoft&nbsp;en étroite collaboration avec l’équipe
Docker. On peut voir par exemple de nombreuses portions de code
source dans le dépôt Docker sur Github pour réaliser
le support de Windows, comme par exemple le commit sélectionné dans
la capture d’écran ci-dessous&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP60.png" title="images/02EP60.png" src="IMAGES/02EP60.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Une particularité du système
d’exploitation de Microsoft est qu’il existe en fait
deux Windows. Ce que le grand public appelle traditionnellement
Windows, à savoir la version pour le poste client, est
en effet très différent de son grand frère
Windows Server, prévu pour les serveurs. Bien sûr,
l’interface graphique (quand elle est activée
côté serveur) est la même et de nombreuses fonctionnalités
sont partagées, mais le cœur du système
diffère encore dans de larges parts.</p>
        </div>
        <div class="sect3" id="refTitle7">
          <h3 class="title">b. Docker et Hyper-V</h3>
          <p class="defaut">C’est ainsi que l’implémentation
de Docker sous Windows est elle-même très différente
entre les deux lignes Windows. Sous Windows 10, il s’est
longtemps agi d’un programme interactif permettant à l’utilisateur
de lancer des conteneurs Windows ou Linux, avec dans ce deuxième
cas un support qui revient à la bonne vieille méthode
de virtualisation décrite plus haut, cette fois en déployant
sur Hyper-V non plus une image boot2docker, mais une version plus
récente basée sur un Moby Linux (distribution
gérée par Docker). Sous Windows Server 2016 puis
2019, le focus est mis sur une implémentation maison de
la gestion des conteneurs, qui reste compatible avec les API (merci
la normalisation), mais ajoute ses propres spécialisations,
comme par exemple un niveau d’isolation complémentaire
des ressources par une utilisation renforcée de l’hyperviseur
maison Hyper-V.</p>
          <p class="defaut">Assez logiquement, il a été décidé que
la version pour Windows 10 embarquerait une Community Edition tandis
que la version pour Windows Server serait une Enterprise Edition.
La différence de cible entre les deux systèmes
d’exploitation (développeur d’un côté,
opérateur de production de l’autre) correspondait
en effet parfaitement avec la séparation des services des
deux éditions, la première gratuite pour le développement&nbsp;et
la seconde avec un support industriel pour la mise en production.</p>
        </div>
        <div class="sect3" id="refTitle8">
          <h3 class="title">c. L’âge de la maturité</h3>
          <p class="defaut">Comme on l’a vu, utiliser des conteneurs sous
Windows est loin d’être une approche native et n’a longtemps été possible
qu’au prix de contorsions techniques, même si celles-ci
pouvaient parfois être habilement cachées. Depuis quelques
années, en effet, Docker peut s’installer et être
exploité assez simplement sous Windows, avec toutefois
quelques limitations qui seront détaillées dans
un autre chapitre, dédié entièrement
au sujet.</p>
          <p class="defaut">L’installation se lance comme pour n’importe
quelle autre application Windows, à l’aide d’un assistant
qui va se charger de copier tous les fichiers nécessaires.
On ne peut toutefois pas parler d’un petit utilitaire car le programme d’installation
seul pèse plus de 100 mégaoctets et ne se prive
pas de télécharger de nombreuses dépendances
et mises à jour. De plus, Docker pour Windows nécessite
d’activer, si ce n’est pas le cas, le module Hyper-V de virtualisation sur
le système d’exploitation de Microsoft.</p>
          <p class="defaut">Passé cette étape, la machine
est prête à exécuter des conteneurs intégrant
des processus Windows, au prix toutefois encore de gros téléchargements,
car le système d’exploitation&nbsp;de Microsoft étant
monolithique et couvrant une longue compatibilité historique,
les images de base sont très lourdes.</p>
          <p class="defaut">Pour s’éviter cette lourdeur, et
aussi paradoxal que cela puisse paraître pour une technologie
d’origine Linux et qui a eu tant de mal à être
intégrée dans Windows, il est possible de faire
exécuter par Docker pour Windows… des conteneurs
Linux&nbsp;!</p>
        </div>
      </div>
      <div class="sect2" id="refTitle9">
        <h2 class="title">3. L’outil Docker pour Windows<var style="display:none"> Docker pour Windows</var></h2>
        <p class="defaut">Nous reviendrons dans un chapitre dédié à Docker
sous Windows sur toutes les spécificités de la
plateforme dans ce contexte qui ne lui est pas natif. Dans la section
ci-dessous, nous ne nous intéressons qu’à ce qui
concerne l’installation de la plateforme.</p>
        <div class="sect3" id="refTitle10">
          <h3 class="title">a. Outil d’installation</h3>
          <p class="defaut">Bien que Docker, comme expliqué plus
haut, ne soit pas une plateforme originellement pensée
pour Windows, mais qui a dû subir de fortes adaptations pour
fonctionner sur ce système, il est désormais presque
transparent pour l’utilisateur de le mettre en œuvre et
ceci est particulièrement vrai dans le cas de l’installation,
pour laquelle un exécutable de déploiement est
disponible comme pour presque toutes les applications Windows, encore
que certaines soient désormais disponibles sur le Microsoft
Store. Ce n’est pas le cas de Docker (en tout cas au moment de l’écriture
du présent ouvrage), et une recherche pointera simplement
sur une application payante alors que Docker et Kubernetes sont
gratuits (donc, méfiance) et sur une application gratuite
qui n’est qu’une surcouche de Docker, permettant à l’aide
d’un assistant graphique de générer les options
pour démarrer un conteneur (nous laissons le lecteur libre de
juger de l’intérêt&nbsp;d’une telle application
après avoir lu le prochain chapitre sur le démarrage
d’un conteneur).</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP61.png" title="images/02EP61.png" src="IMAGES/02EP61.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Pour installer Docker sur Windows, le plus
simple est de passer par le site légitime, à savoir <a class="url" href="https://docs.docker.com/get-docker/" target="_blank">https://docs.docker.com/get-docker/</a>,
et de choisir l’option correspondante&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP62.png" title="images/02EP62.png" src="IMAGES/02EP62.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">La page <a class="url" href="https://docs.docker.com/docker-for-windows/install/" target="_blank">https://docs.docker.com/docker-for-windows/install/</a> vous
permettra de télécharger&nbsp;l’assistant
(bouton du haut) et donnera de nombreux détails sur le
contenu du programme, qu’il est inutile de reproduire ici&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP63.png" title="images/02EP63.png" src="IMAGES/02EP63.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Il est toutefois important de souligner les
prérequis pour le programme, qui ne fonctionnera que sur
un Windows 10 64 bits et dont on aura activé les options de
virtualisation, à la fois logicielle (les fonctionnalités
Hyper-V seront activées lors de l’installation si besoin),
mais aussi matérielle (VT-X, SLAT). Pour ce qui est de
la version de Windows, vous ne pourrez utiliser une édition Home
qu’en passant par WSL (voir plus loin), et pour les autres éditions
il sera nécessaire de disposer de la build 16299 au moins.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">En pratique, il est recommandable
d’utiliser au minimum une version 18.09, car nombreuses sont les
améliorations qui ont été apportées
depuis cette version, en particulier sur le support de localhost
lors de l’appel d’un conteneur lancé en local (dans les
versions&nbsp;précédentes, il est nécessaire
de trouver l’adresse IP du conteneur, mais nous reviendrons&nbsp;plus
en détail sur ce point dans le chapitre suivant, lors du
premier lancement d’un conteneur Docker).</p>
            </div>
          </div>
          <p class="defaut">Pour rester sur le sujet de la virtualisation,
il est possible d’installer Docker sur une machine&nbsp;elle-même
virtuelle, mais cela conduit à une virtualisation imbriquée
dont le fonctionnement est possible, mais pas garanti. Si ce mode
de fonctionnement est nécessaire,&nbsp;une recherche
en anglais sur les termes nested virtualization remontera les documentations
nécessaires. Pour tous les autres problèmes d’installation,
la documentation se trouve sur : <a class="url" href="https://docs.docker.com/docker-for-windows/troubleshoot/" target="_blank">https://docs.docker.com/docker-for-windows/troubleshoot/</a></p>
          <p class="defaut">Enfin, pour exploiter des conteneurs Docker
Linux sous Windows sans passer par une quelconque virtualisation,
il sera nécessaire d’installer le Windows Subsystem for
Linux,&nbsp;en version 2, ce qui nécessite une version
récente de Windows (au moins une 2004, soit la release
d’avril 2020).</p>
        </div>
        <div class="sect3" id="refTitle11">
          <h3 class="title">b. Choix du canal<var style="display:none"> Canal</var></h3>
          <p class="defaut">Une des rares options à choisir lors
de l’installation de Docker est le mode de déploiement
et de mise à jour des versions. Docker propose deux modes, à savoir <span class="courier11">stable</span> et <span class="courier11">edge</span>.
Dans le premier, les mises à jour sont poussées
de manière trimestrielle et le contenu a une garantie de
stabilité. Dans le second, les mises à jour sont
mensuelles, donc l’utilisateur bénéficie
plus vite des nouvelles fonctionnalités. Ou selon les mots
de Docker&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP64.png" title="images/02EP64.png" src="IMAGES/02EP64.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Attention à ne pas confondre ce second
mode avec le mode expérimental de fonctionnement de Docker.
Le mode expérimental peut être activé en
changeant une option de démarrage du démon Docker,
rendant ainsi actives des fonctionnalités toutes nouvelles,
voire en cours de développement, et qui peuvent empêcher
le fonctionnement correct de Docker. Ce mode est donc à réserver
en général aux bêta-testeurs et développeurs.
Le mode de diffusion <span class="courier11">edge</span> ne va
pas aussi loin&nbsp;: il offre certes plus vite des fonctionnalités,
qui n’auront donc pas bénéficié de
plusieurs mois en production, mais celles-ci sont des fonctionnalités
testées et validées avant mise à disposition
par le canal de mise à jour officiel.</p>
          <p class="defaut">Pour revenir sur la manipulation commencée
dans la section précédente, la page de téléchargement&nbsp;sur
laquelle l’utilisateur est dirigé depuis le site de documentation
de Docker est la suivante, hébergée sur le site
Docker Hub&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP65.png" title="images/02EP65.png" src="IMAGES/02EP65.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">C’est en choisissant le téléchargement
de l’assistant qu’on sélectionne le canal souhaité.&nbsp;Dans
le doute sur le canal à choisir, il est recommandé d’utiliser
le canal <span class="courier11">stable</span>. Il reste possible
de modifier après coup ce choix, mais ceci nécessite
de supprimer&nbsp;l’installation de Docker Desktop et de réinstaller
avec l’autre assistant, ce qui prend un peu de temps et peut avoir
des impacts sur le paramétrage courant de Docker sur la
machine.&nbsp;</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">À titre d’information, le
fichier d’installation pour le canal <span class="courier11">edge</span> en
août 2020 pesait 405&nbsp;Mo.</p>
            </div>
          </div>
        </div>
        <div class="sect3" id="refTitle12">
          <h3 class="title">c. Mises à jour</h3>
          <p class="defaut">Sous Windows, les mises à jour sont
déclenchées automatiquement, en tout cas dans
le paramétrage par défaut. À chaque fois
qu’une nouvelle version est disponible, l’utilisateur sera donc
informé par une boîte de dialogue comme ci-dessous,
reprenant la liste des informations liées aux nouvelles
fonctionnalités et aux différents bugs corrigés&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP66.png" title="images/02EP66.png" src="IMAGES/02EP66.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
        </div>
        <div class="sect3" id="refTitle13">
          <h3 class="title">d. Assistant d’installation</h3>
          <p class="defaut">Une fois l’installation proprement dite lancée,
le processus se déroule sans intervention particulière
de l’utilisateur. Aucun paramétrage n’est nécessaire lors
de l’installation elle-même, toutes les options pouvant être
modifiées après coup, et le reste étant
imposé (par exemple, on ne peut pas choisir dans l’assistant
la localisation du programme sur le disque dur).</p>
          <p class="defaut">L’assistant montre les fichiers installés&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP67.png" title="images/02EP67.png" src="IMAGES/02EP67.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Dans cette liste, on voit passer par
exemple kubectl.exe ainsi que docker-compose.exe. Nous verrons plus
loin à quoi correspondent ces outils&nbsp;; cette remarque
est simplement pour illustrer que Docker Desktop n’installe pas
seulement Docker lui-même, mais une grande partie de l’écosystème
standard d’outils qui lui sont traditionnellement ajoutés.</p>
            </div>
          </div>
          <p class="defaut">Enfin, lorsque l’assistant a fini son travail
et a été fermé, vous pouvez lancer Docker
Desktop à partir de l’icône déployée
sur le bureau ou bien en passant par le menu Démarrer.&nbsp;Par
défaut, Docker démarre automatiquement lorsqu’un
utilisateur se connecte, mais en fin d’installation, si on ne souhaite
pas sortir de la session, il convient de le démarrer manuellement.
Une notification apparaît au bout de quelques instants
pour signaler que Docker Desktop est en cours de lancement, puis
de fonctionnement&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP68.png" title="images/02EP68.png" src="IMAGES/02EP68.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Lors du premier lancement, Docker propose
un tutoriel que les utilisateurs pourront utiliser pour réaliser
un premier lancement très simple d’un conteneur&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP69.png" title="images/02EP69.png" src="IMAGES/02EP69.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">L’absence de message ou d’interface graphique
pourra dérouter lors des premières utilisations,
surtout que Docker a justement fait l’effort sous Windows de fournir
des fenêtres&nbsp;de paramétrage. Il se trouve
simplement que l’accès à toutes ces options se
fait depuis les icônes en bas à droite de la barre Windows&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP70.png" title="images/02EP70.png" src="IMAGES/02EP70.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Si l’icône de baleine n’apparaît
pas dans la barre (comme ci-dessus), il faudra aller la chercher
en cliquant sur l’icône en forme de chevrons qui montre toutes
les icônes cachées&nbsp;par défaut.
Pour que l’icône reste en permanence accessible, ce sont
les paramètres Windows qu’il conviendra de changer, dans
la section suivante&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP71.png" title="images/02EP71.png" src="IMAGES/02EP71.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
        </div>
        <div class="sect3" id="refTitle14">
          <h3 class="title">e. Enfin du natif avec WSL 2</h3>
          <p class="defaut">Depuis quelque temps, il existe une fonctionnalité dans
Windows 10 qui s’appelle Windows Subsystem for Linux, ou WSL en
abrégé. La version 2 actuelle est beaucoup plus
aboutie que la première, qui était en quelque
sorte un galop d’essai de la technologie,&nbsp;avec de nombreuses
limitations. Cette fonctionnalité permet d’héberger
un système Linux à l’intérieur même
du système d’exploitation Windows.<var style="display:none"> Windows Subsystem for Linux</var></p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Même si la fonctionnalité est
assez nouvelle (WSL 2 est apparu sur la version 2004, soit avril
2020, de Windows 10), elle existe sur des versions plus anciennes, Microsoft
ayant décidé, dans un mouvement rare, de "backporter"
cette évolution sur toutes les versions de Windows 10 depuis
la 1903, soit mars 2019.</p>
            </div>
          </div>
          <p class="defaut">Il ne s’agit pas là de la prise en
charge d’un démarrage multiple de la machine dans un système
ou dans l’autre, qui ferait que seul un des deux systèmes
serait disponible à la fois, et qu’une procédure
de redémarrage de la machine serait nécessaire
pour basculer&nbsp;d’un système à un autre&nbsp;:
les deux systèmes sont accessibles depuis la même
session Windows.</p>
          <p class="defaut">Il ne s’agit pas non plus d’une technologie
de virtualisation, mais bien d’une intégration des primitives
du système d’exploitation de Linux dans celui, propriétaire,
de Microsoft&nbsp;: pas d’hyperviseur ni d’émulation,
c’est bien un sous-système d’exploitation qui est embarqué dans
Windows et permet l’exécution native d’appels Linux.</p>
          <p class="defaut">Il n’entre pas dans le périmètre
de l’ouvrage de détailler la mise en place de WSL 2 sur
Windows, mais pour résumer, il suffit sur les systèmes
récents d’activer la fonctionnalité correspondante&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP72.png" title="images/02EP72.png" src="IMAGES/02EP72.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Puis, le système Linux local étant
en place, il convient d’installer une distribution Linux&nbsp;dessus
(voire plusieurs, d’ailleurs), manipulation qui peut être
opérée aisément depuis le Microsoft Store,
en cherchant la distribution de votre choix&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP73.png" title="images/02EP73.png" src="IMAGES/02EP73.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Après installation, une icône
apparaît dans le menu Démarrer, qui permet d’accéder à un
véritable système d’exploitation Linux (Ubuntu
dans la capture ci-dessous) intégré dans le système
Windows&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP74.png" title="images/02EP74.png" src="IMAGES/02EP74.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Encore une fois, il n’y a pas de limitation
liée à une quelconque émulation ou virtualisation&nbsp;:
le système Ubuntu voit les disques, les périphériques,
peut occuper un port réseau et consommer des ressources
de la machine, etc. Si vous utilisez une console capable de supporter
des shells multiples (par exemple le nouveau Windows Terminal que
vous pouvez obtenir dans le Microsoft Store), vous verrez ainsi
le choix suivant&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP75.png" title="images/02EP75.png" src="IMAGES/02EP75.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Il était logique que Docker sous
Windows exploite cette fonctionnalité pour se passer de
la couche de virtualisation Hyper-V lors de l’exécution
de conteneurs Linux, et c’est désormais chose faite en
début 2020. Pour cela, il convient d’utiliser la version
2 de WSL, qui est, comme on l’a vu, désormais livrée
directement dans Windows 10, et non plus disponible en tant que
fonctionnalité expérimentale. Il est toutefois
nécessaire pour cela de bien disposer de la version 2004
de Windows 10.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Il ne s’agit pas d’une erreur de frappe,
mais bien de la version 2004 de Windows 10, les deux premiers chiffres
désignant l’année de sortie (20 pour 2020) et
les deux derniers le mois, en l’occurrence avril (04).</p>
            </div>
          </div>
          <p class="defaut">Si WSL 2 est actif sur le poste, l’assistant
d’installation Docker Desktop le détecte et propose que
l’installation tire parti de cette fonctionnalité&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP76.png" title="images/02EP76.png" src="IMAGES/02EP76.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Attention, bien que Docker propose d’installer
WSL 2 par lui-même lors de la phase d’installation, il
se peut que le message suivant apparaisse, la mise à jour du
noyau n’étant à ce jour pas effectuée
par cet assistant&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP106.png" title="images/02EP106.png" src="IMAGES/02EP106.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">De même, si les fonctionnalités
de virtualisation de Windows ne sont pas installées (ou
bien si les jeux d’instructions matériels ne sont pas activés
dans le BIOS), un message&nbsp;comme suit peut bloquer le démarrage
du serveur applicatif Docker&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP107.png" title="images/02EP107.png" src="IMAGES/02EP107.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Malgré ces potentielles difficultés
d’installation, le module étant encore relativement jeune,
l’utilisation de WSL 2 apporte un réel plus à Docker
sous Windows.</p>
          <p class="defaut">Le panneau de paramétrage de Docker
montre d’ailleurs que le moteur basé sur WSL&nbsp;2
est même préféré à celui
d’Hyper-V pour des questions de performance, ce qui est logique&nbsp;car
on évite une couche de virtualisation qui était
nécessaire pour les premières&nbsp;exécutions
de conteneurs Docker Linux sur Windows, mais représentait
tout de même une sérieuse entorse aux principes
de simplicité d’architecture&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP77.png" title="images/02EP77.png" src="IMAGES/02EP77.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Un coup d’œil sur les fonctionnalités
de Windows permet de vérifier qu’Hyper-V est effectivement
inactif dans ce mode&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP78.png" title="images/02EP78.png" src="IMAGES/02EP78.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">La page <a class="url" href="https://docs.docker.com/docker-for-windows/wsl/" target="_blank">https://docs.docker.com/docker-for-windows/wsl/</a> donne
tous les détails sur ce mode de fonctionnement de Docker
sous Windows, et en particulier permet d’obtenir&nbsp;la mise à jour
du noyau Linux qui est nécessaire au bon fonctionnement
du "backend WSL 2 pour Docker".</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP79.png" title="images/02EP79.png" src="IMAGES/02EP79.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">À titre de remarque, WSL
2 permet de développer depuis Visual Studio Code sur le
noyau Linux, et donc dans notre cas sur des conteneurs, comme la
page ci-dessus le souligne. Une autre ressource internet donne plus
de détails sur cette fonctionnalité qui pourra
intéresser les développeurs&nbsp;: <a class="url" href="https://code.visualstudio.com/blogs/2020/03/02/docker-in-wsl2" target="_blank">https://code.visualstudio.com/blogs/2020/03/02/docker-in-wsl2</a></p>
            </div>
          </div>
          <p class="defaut">Il est à noter qu’il est possible
de changer de backend et de repasser sur Hyper-V, même
si la bascule dans le sens inverse est plus logique. Par contre,
la dépendance à l’hyperviseur et aux contraintes
de virtualisation reviendra bien sûr avec cette manipulation.</p>
          <p class="defaut">De la même manière, si on
passe en mode conteneurs Windows, il faut également qu’Hyper-V
soit actif sur la machine&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP80.png" title="images/02EP80.png" src="IMAGES/02EP80.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Sans rentrer dans les détails
qui seront expliqués dans le chapitre dédié aux spécificités
des manipulations de Docker sous Windows, Docker sous Windows permet
de lancer des conteneurs prévus pour Linux, mais également
des conteneurs avec un système Windows à l’intérieur.
Docker Desktop permet de basculer d’un mode à un autre,
les deux ne pouvant pas être lancés en même temps.</p>
            </div>
          </div>
        </div>
        <div class="sect3" id="refTitle15">
          <h3 class="title">f. Désinstallation</h3>
          <p class="defaut">La fonctionnalité de désinstallation
ne mérite pas qu’on s’y attarde, car elle est tout simplement
disponible comme pour toute autre application Windows dans le Panneau&nbsp;de
configuration, sur la section <b>Programmes</b>&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP81.png" title="images/02EP81.png" src="IMAGES/02EP81.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Bien que Docker soit plus qu’une simple application
et s’intègre de façon beaucoup plus profonde dans
le système d’exploitation, il est visible par les utilisateurs
au même titre que n’importe quel autre programme.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle16">
        <h2 class="title">4. Docker pour Windows Server<var style="display:none"> Docker pour Windows Server</var></h2>
        <div class="sect3" id="refTitle17">
          <h3 class="title">a. Installation</h3>
          <p class="defaut">L’installation de Docker sous Windows Server étant
radicalement différente de celle sous Windows 10, il convenait
de créer une section dédiée. Par contre, il
n’y a pas de différence entre les versions 2016 et 2019,
donc la procédure sera décrite de manière
générique.</p>
          <p class="defaut">Contrairement à l’installation sur
un Windows client, nul installateur côté serveur&nbsp;:
les modules sont portés par les fournisseurs de paquets
logiciels, en l’occurrence un fournisseur dédié par
Microsoft à la gestion de Docker.</p>
          <p class="defaut">La page dédiée montre tout
d’abord qu’il n’est pas question de Community Edition sur un Windows
Server. Ce type de système d’exploitation étant
dédié à la production et non à des
essais par un développeur ou un administrateur, c’est l’Enterprise
Edition qui est imposée&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP82.png" title="images/02EP82.png" src="IMAGES/02EP82.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">En descendant dans la page web, on s’aperçoit
que l’installation est également simple, avec seulement
deux commandes à lancer dans PowerShell&nbsp;:<var style="display:none"> PowerShell</var></p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP83.png" title="images/02EP83.png" src="IMAGES/02EP83.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Pour les exécuter, il est toutefois
nécessaire de lancer l’invite de commandes PowerShell&nbsp;en
mode administrateur&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP84.png" title="images/02EP84.png" src="IMAGES/02EP84.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">La première instruction à exécuter
est la suivante, qui permet de rajouter le fournisseur de paquetages
prévu par Microsoft pour Docker&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql"><span class="hljs-keyword">Install</span>-<span class="hljs-keyword">Module</span> -<span class="hljs-keyword">Name</span> DockerMsftProvider -Repository PSGallery</code></pre>
          <p class="defaut">Son exécution (sauf si on utilise
la balise <span class="courier11">-Force</span>) amène à l’invite
ci-dessous&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP85.png" title="images/02EP85.png" src="IMAGES/02EP85.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Il faut entrer <b>Y</b> et
taper sur [Entrée] pour continuer. Une
seconde interaction est alors nécessaire pour confirmer
qu’on souhaite utiliser un dépôt qui n’est pas
(en tout cas à l’heure actuelle) référencé comme
sûr par le système&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP86.png" title="images/02EP86.png" src="IMAGES/02EP86.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Le caractère <b>A</b> correspondant à la
réponse <b>Yes to All</b> permet
de passer toutes les autres demandes éventuelles de confirmation.
La commande suivante permet d’utiliser le dépôt
installé pour récupérer et déployer
le paquet logiciel nommé <span class="courier11">docker</span>.</p>
          <pre class="programlisting"><code class="hljs sql"><span class="hljs-keyword">Install</span>-<span class="hljs-keyword">Package</span> -<span class="hljs-keyword">Name</span> docker -ProviderName DockerMsftProvider</code></pre>
          <p class="defaut">Là encore, on acceptera par défaut
les packages proposés. La source n’est pas marquée
par le système comme "trusted", mais il s’agit de la commande
de référence issue de la documentation Microsoft.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP87.png" title="images/02EP87.png" src="IMAGES/02EP87.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Une barre de progression en mode texte permet
de suivre l’avancée du processus&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP88.png" title="images/02EP88.png" src="IMAGES/02EP88.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Une fois la commande déroulée,
un avertissement indique qu’un redémarrage est alors nécessaire&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP89.png" title="images/02EP89.png" src="IMAGES/02EP89.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">En effet, l’outil client Docker est bien présent,
mais le moteur Docker (la partie serveur,&nbsp;qui exécute
les conteneurs) n’est pas démarré, ce qui fait
qu’un appel à la commande&nbsp;<span class="courier11">docker
version</span> montrera uniquement la version du client et un message&nbsp;d’erreur
de connexion au serveur&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP90.png" title="images/02EP90.png" src="IMAGES/02EP90.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Pour l’instant, nous demandons au
lecteur sans connaissance de Docker d’exécuter ces commandes
sans connaître la distinction entre les fonctionnalités
du client et celles du moteur Docker, ni même ce que recouvre
précisément la notion de conteneur ou d’image.
Tout ceci va être expliqué avec de nombreux détails
plus loin dans le présent ouvrage, mais il est nécessaire
de commencer par l’installation, et ce processus nous oblige à manipuler,
ne serait-ce que très légèrement, le
système Docker à étudier.</p>
            </div>
          </div>
          <p class="defaut">Après que le système a été redémarré (par
la commande de l’interface graphique de Windows Server ou bien avec
un <span class="courier11">Restart-Computer</span> dans l’invite
PowerShell), la commande <span class="courier11">docker</span> version
permet cette fois de voir que le moteur est bien présent
et répond&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP91.png" title="images/02EP91.png" src="IMAGES/02EP91.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">À noter que dans certains
cas, un simple <span class="courier11">Restart-Service docker</span> peut
suffire plutôt qu’un redémarrage de la machine,
mais l’auteur ne peut pas l’assurer, ce comportement pouvant être
très dépendant d’un contexte d’exécution
particulier. Il est recommandé de suivre les instructions
de la commande elle-même.</p>
            </div>
          </div>
          <p class="defaut">Le présent chapitre étant
consacré uniquement à l’installation et non à la
description des commandes de Docker, nous ne montrons pas comment
tester que l’installation a bien fonctionné, mais renvoyons
pour cela l’utilisateur aux chapitres suivants, et en particulier
celui sur les spécificités Windows, le cas échéant.
En pratique, une fois les commandes d’installation effectuées,
l’utilisation de la ligne de commande est strictement la
même que sous Windows 10, et d’ailleurs que sous
Linux puisque l’API est standardisée et que Microsoft assure
son respect dans son implémentation des conteneurs, seules
quelques spécificités sur les paramètres
d’exécution pouvant exister sur l’un ou l’autre des systèmes
d’exploitation, qui ne partagent pas tous les mêmes primitives système.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Les noms de fichiers sont, par exemple,
une différence parmi les plus connues entre Linux&nbsp;et
Windows, et Docker doit se plier à la grammaire de chacun, même
si nous verrons&nbsp;plus loin qu’il peut parfois tordre légèrement
la situation pour unifier les façons de faire.</p>
            </div>
          </div>
        </div>
        <div class="sect3" id="refTitle18">
          <h3 class="title">b. Utilisation de machines préinstallées</h3>
          <p class="defaut">L’installation sous Windows Server
n’est donc pas tellement plus compliquée que sous
Windows 10. Bien sûr, il est également possible
(et plus simple pour des essais) de recourir à des machines
déjà prêtes. Pour cela, les boutons <b>Deploy to Azure</b> disponibles dans la
documentation Docker sont particulièrement pratiques. Dans
Azure également, certaines images Windows Server voient
leur titre suffixé par <span class="courier11">- with
containers</span> pour signifier que la gestion de conteneurs y
sera activée dès l’instanciation.</p>
          <p class="defaut">C’est d’ailleurs également le cas
dans Amazon Web Services, où la console permet de choisir
des systèmes d’exploitation avec le support des conteneurs Docker
préparamétré.</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP92.png" title="images/02EP92.png" src="IMAGES/02EP92.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
        </div>
        <div class="sect3" id="refTitle19">
          <h3 class="title">c. Exécution de conteneurs Linux</h3>
          <p class="defaut">Lorsque nous avons traité de l’installation
de Docker sous Windows 10 (le système d’exploitation de
Microsoft dans sa version client), nous avons vu que le mode de
fonctionnement par défaut était de lancer des
conteneurs Docker avec des images Linux.&nbsp;C’est d’ailleurs
ce qui nécessitait que la virtualisation Hyper-V soit installée,
ou bien que le Windows Subsystem for Linux soit actif. Si l’utilisateur
souhaitait lancer des images contenant un processus Windows, il était
nécessaire de basculer Docker Desktop dans ce mode, qui
nécessitait en l’occurrence également la virtualisation.</p>
          <p class="defaut">Dans le cadre d’un système d’exploitation
Windows en mode serveur, c’est l’inverse qui se passe, et le mode
de fonctionnement standard est de lancer des conteneurs sur des
images avec des applications Windows, et non Linux par défaut.
Mais il est possible&nbsp;toutefois, toujours sous Windows Server,
de lancer des conteneurs Linux, même si cela ne peut pas être
réalisé en même temps que des conteneurs
Windows. L’implémentation de Docker pour Windows Server
ne comporte cependant pas la même commande <span class="courier11">Switch to Linux containers</span> que la
version pour Windows 10. Pour activer le mode LCOW (pour <span class="italic">Linux Containers On Windows</span>), il
faut modifier une variable&nbsp;d’environnement et - encore
une fois - activer une machine virtuelle.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Comme cela avait été dit
plus haut, le recours à une machine virtuelle cachée
pose des problèmes de performance et de stabilité pour
les conteneurs qui font que cette solution ne peut être
raisonnablement utilisée à ce jour pour des charges
de production. Si un mélange en production doit être
réalisé entre des conteneurs Windows et des conteneurs
Linux, alors un cluster de machines Docker hybride est réalisable,
avec un moteur Docker distribué entre des nœuds
Linux et des nœuds Windows et une capacité à lancer
des conteneurs sur les machines adéquates en fonction de
l’image utilisée. Ceci dépasse toutefois largement
le cadre du présent ouvrage.</p>
            </div>
          </div>
          <p class="defaut">Pour activer le mode LCOW, il est nécessaire
d’intervenir dans les fonctionnalités et rôles
du serveur Windows Server&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP93.png" title="images/02EP93.png" src="IMAGES/02EP93.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Add roles and features</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Next</b>.</p>
          </div>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP94.png" title="images/02EP94.png" src="IMAGES/02EP94.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans la fenêtre ci-dessus, laissez
l’option affichée par défaut.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Next</b>.</p>
          </div>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP95.png" title="images/02EP95.png" src="IMAGES/02EP95.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez à nouveau sur <b>Next</b>.</p>
          </div>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP96.png" title="images/02EP96.png" src="IMAGES/02EP96.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cochez la fonctionnalité <b>Hyper-V</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Next</b>.</p>
          </div>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP97.png" title="images/02EP97.png" src="IMAGES/02EP97.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Add Features</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>De retour dans l’interface précédente,
cliquez sur <b>Install</b>.</p>
          </div>
          <p class="defaut">L’équivalent des manipulations ci-dessus
en ligne de commande est&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql"><span class="hljs-keyword">Install</span>-WindowsFeature Hyper-V -IncludeManagementTools -Restart</code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Attention, si vous vous trouvez sur
une machine virtuelle, il est nécessaire d’activer la virtualisation
imbriquée, car Hyper-V aura besoin de virtualiser des ressources
qui sont déjà virtualisées, à l’aide
de la commande <span class="courier11">Set-VMProcessor -ExposeVirtualizationExtensions $true</span></p>
            </div>
          </div>
          <p class="defaut">Enfin, il est nécessaire de basculer
dans le mode LCOW en changeant une variable d’environnement et en
relançant le service <span class="courier11">docker</span>&nbsp;:</p>
          <pre class="programlisting"><code class="hljs scss"><span class="hljs-selector-attr">[Environment]</span>::SetEnvironmentVariable(<span class="hljs-string">"LCOW_SUPPORTED"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"Machine"</span>)&nbsp;
Restart-Service docker</code></pre>
          <p class="defaut">Au moment de l’écriture du présent
ouvrage, il était nécessaire d’activer les fonctionnalités
expérimentales (en ajoutant <span class="courier11">"experimental":
"true"</span> dans le fichier de configuration du démon
Docker qui se trouve normalement dans <span class="courier11">C:\ProgramData\docker\config</span>),
mais il se pourrait bien que ce ne soit plus nécessaire
au moment où le lecteur fera le test, les versions changeant
assez vite.</p>
        </div>
        <div class="sect3" id="refTitle20">
          <h3 class="title">d. Paramétrage système</h3>
          <p class="defaut">Sous Windows, ce n’est pas le protocole
HTTP qui est utilisé par défaut pour les communications&nbsp;internes
de Docker, mais les named pipes. S’il est nécessaire
d’accéder avec un client quelconque en passant
par le traditionnel port TCP 2375, alors des commandes supplémentaires
doivent être utilisées pour ouvrir ce mode de
fonctionnement en plus&nbsp;:</p>
          <pre class="programlisting"><code class="hljs sql"><span class="hljs-keyword">Stop</span>-Service Docker&nbsp;
dockerd <span class="hljs-comment">--unregister-service&nbsp;</span>
dockerd -H npipe:// -H <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">2375</span> <span class="hljs-comment">--register-service&nbsp;</span>
<span class="hljs-keyword">Start</span>-Service Docker</code></pre>
          <p class="defaut">Et bien sûr, il conviendra également
d’ouvrir le port 2375 sur le pare-feu local (ainsi que dans tout équipement
réseau qui se placerait en amont, par exemple sur le Network
Security Group d’Azure si vous utilisez une machine dans
le cloud de Microsoft).&nbsp;Sur Windows Server en utilisant
PowerShell, la commande est la suivante, la valeur&nbsp;de l’attribut <span class="courier11">name</span> correspondant au titre de la
règle de pare-feu et pouvant donc être modifiée
au gré de l’utilisateur&nbsp;:</p>
          <pre class="programlisting"><code class="hljs cs">netsh advfirewall firewall <span class="hljs-keyword">add</span> rule name=docker dir=<span class="hljs-keyword">in</span> &nbsp;
protocol=tcp localport=<span class="hljs-number">2375</span> action=allow</code></pre>
          <p class="defaut">Ceci clôt la section sur l’installation
de Docker en mode Windows.</p>
        </div>
      </div>
      <div class="sect2" id="refTitle21">
        <h2 class="title">5. Utilisation de Docker avec Vagrant<var style="display:none"> Vagrant</var></h2>
        <div class="sect3" id="refTitle22">
          <h3 class="title">a. Principe</h3>
          <p class="defaut">Dans les prochains chapitres, la mise en place
de cluster de machines Docker sera montrée et il est intéressant
dans ces cas de figure d’automatiser la mise en place de plusieurs
machines avec un moteur Docker installé. Une des méthodes
pour atteindre ce but est d’automatiser les commandes utilisées
lors des créations de machines dans les clouds (un cloud
comme Azure propose par exemple en fin d’assistant le script ou
le fichier de paramétrage permettant d’automatiser tous
les choix qui ont été réalisés à la
main dans un premier temps), mais il est également possible
d’utiliser des logiciels spécialisés pour cela.
On recourt alors à des scripts appelant les API du logiciel
de virtualisation, mais cela nécessite des compétences
techniques relativement avancées.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Les API (<span class="italic">Application Programming Interfaces</span>)
sont des points d’entrée prévus par un logiciel&nbsp;pour
laisser un autre système accéder de manière
informatique à certaines de ses fonctionnalités.
Ces API utilisent assez souvent le protocole HTTP pour s’ouvrir à l’extérieur.&nbsp;Parfois,
les API ne sont accessibles que par des langages de programmation,
ce qui complexifie légèrement leur utilisation.</p>
            </div>
          </div>
          <p class="defaut">Sans rentrer dans des plateformes complexes
comme Terraform ou Chef, il paraissait utile de montrer une façon
simple de préparer facilement des ensembles de machines
virtuelles préconfigurées, et nous allons pour
cela utiliser Vagrant, qui est justement prévu pour initialiser,
autoriser le paramétrage et exécuter ce genre
de scripts. Vagrant utilise des scripts en langage Ruby pour manipuler
les API de différents logiciels de virtualisation. Vagrant
assiste l’utilisateur à toutes les étapes de la
création automatisée d’une machine virtuelle&nbsp;:</p>
          <div class="divliste1">
            <ul class="liste1">
              <li class="liste1">
                <p class="liste1">Une simple ligne de
commande suffit pour initialiser un script de génération de
machine virtuelle avec des nombreuses options.</p>
              </li>
              <li class="liste1">
                <p class="liste1">Ce script par défaut montre,
sous forme inactive, de nombreuses options qui peuvent être
activées ou modifiées de façon à affiner
le comportement voulu. Ces lignes de paramétrage sont accompagnées
de liens vers la documentation, ce qui rend l’opération
particulièrement abordable, y compris pour des débutants
dans l’utilisation du logiciel.</p>
              </li>
              <li class="liste1">
                <p class="liste1">Une fois le script modifié,
Vagrant se charge de son exécution, mais aussi de fournir
des commandes permettant de gérer le cycle de vie de la
machine. Le script généré permet de la
démarrer, mais Vagrant permet de l’arrêter, de
repartir d’une machine vide, de lancer des opérations particulières
dessus, etc.</p>
              </li>
            </ul>
          </div>
          <p class="defaut">Ces principes peuvent paraître flous
pour l’instant, mais nous allons les éclaircir dans la
prochaine section par une mise en pratique.</p>
        </div>
        <div class="sect3" id="refTitle23">
          <h3 class="title">b. Création d’une machine</h3>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">L’installation du logiciel Vagrant
ne posant aucune difficulté particulière, que ce
soit sous Linux ou sous Windows, nous ne détaillons donc
pas cette étape.</p>
            </div>
          </div>
          <p class="defaut">Afin de garder une organisation propre, il
est nécessaire de créer un répertoire pour
chaque machine Vagrant, et c’est dans ce répertoire que
nous lancerons la commande qui va préparer un fichier de
script Vagrant&nbsp;:</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Créez un répertoire, nommé par
exemple <span class="courier11">Vagrant</span>, qui vous servira
de localisation centrale pour tous les répertoires de machines
Vagrant.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Placez-vous dans le répertoire juste
créé et créez un sous-répertoire,
appelé par exemple <span class="courier11">Agent1</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans ce répertoire, lancez la commande <span class="courier11">vagrant init</span>.</p>
          </div>
          <p class="defaut">Un fichier nommé <span class="courier11">Vagrantfile</span> y
sera créé, avec un contenu par défaut
que nous allons étudier. Afin de ne pas encombrer l’affichage,
nous reproduisons ci-dessous ce contenu par défaut en enlevant
la plupart des lignes commençant par le signe <span class="courier11">#</span>, qui est la marque des
commentaires (le fichier en est particulièrement fourni,
facilitant ainsi le paramétrage des options les plus standards)&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet"><span class="hljs-meta"># -*- mode: ruby -*-&nbsp;</span>
<span class="hljs-meta"># vi: set ft=ruby :&nbsp;</span>
&nbsp;
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> |config|&nbsp;
&nbsp;&nbsp;config.vm.box = <span class="hljs-string">"base"</span>&nbsp;
<span class="hljs-keyword">end</span></code></pre>
          <p class="defaut">À la place de l’image de base proposée
par défaut, nous allons utiliser un système Ubuntu
en version 16.04 LTS (nom de code Xenial Xerus), en 64 bits. Comme
l’indiquent les commentaires au-dessus de la ligne <span class="courier11">config.vm.box = "base"</span> (non
reproduits ci-dessus), il faut pour cela affecter au paramètre une
autre valeur parmi celles proposées sur <a class="url" href="https://app.vagrantup.com/boxes/search" target="_blank">https://app.vagrantup.com/boxes/search</a>, à savoir
pour notre choix <span class="courier11">Ubuntu/xenial64</span>.
Le fichier devient donc le suivant (sans les commentaires, bien
sûr, que nous omettrons systématiquement, comme
expliqué plus haut)&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet"><span class="hljs-meta"># -*- mode: ruby -*-&nbsp;</span>
<span class="hljs-meta"># vi: set ft=ruby :&nbsp;</span>
&nbsp;
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> |config|&nbsp;
&nbsp;&nbsp;config.vm.box = <span class="hljs-string">"</span><b><span class="hljs-string">ubuntu/xenial64</span></b><span class="hljs-string">"</span>&nbsp;
<span class="hljs-keyword">end</span></code></pre>
          <p class="defaut">Une autre option que nous allons modifier
consistera à activer le mode de réseau public.&nbsp;Dans
ce mode, la machine virtuelle créée par Vagrant
se comporte sur le réseau de la même manière
qu’une machine qui y serait directement reliée. Elle aura
donc son adresse IP au même titre que votre machine hôte.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Il aurait également été possible
d’utiliser l’option de réseau privé de Vagrant, qui
permet de donner un accès à la seule machine hôte
en passant par une IP fixe, mais passer par un réseau public
est plus proche de ce qui se passerait en production avec plusieurs
machines au même niveau. De plus, cette façon
de faire permet de ne pas avoir à se poser de questions
sur un éventuel routage entre des réseaux privés
séparés.</p>
            </div>
          </div>
          <p class="defaut">Le plus simple pour mettre en place cette
option de réseau est de supprimer le caractère <span class="courier11">#</span> de commentaire devant la
ligne concernée, produisant ainsi un fichier équivalent à celui-ci&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet"><span class="hljs-meta"># -*- mode: ruby -*-&nbsp;</span>
<span class="hljs-meta"># vi: set ft=ruby :&nbsp;</span>
&nbsp;
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> |config|&nbsp;
&nbsp;&nbsp;config.vm.box = <span class="hljs-string">"ubuntu/xenial64"</span><b>&nbsp;
&nbsp;&nbsp;config.vm.network <span class="hljs-string">"public_network"</span></b>&nbsp;
<span class="hljs-keyword">end</span></code></pre>
          <p class="defaut">Pour des raisons pratiques, nous nommerons
la machine virtuelle créée par Vagrant avec le
même nom que celui choisi pour le répertoire de
définition, à savoir <span class="courier11">Agent1</span> dans
notre exemple. L’option à utiliser pour cela est la suivante&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet"><span class="hljs-meta"># -*- mode: ruby -*-&nbsp;</span>
<span class="hljs-meta"># vi: set ft=ruby :&nbsp;</span>
&nbsp;
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> |config|&nbsp;
&nbsp;&nbsp;config.vm.box = <span class="hljs-string">"ubuntu/xenial64"</span><b>&nbsp;
&nbsp;&nbsp;config.vm.network <span class="hljs-string">"public_network"</span>&nbsp;
&nbsp;&nbsp;config.vm.provider <span class="hljs-string">"virtualbox"</span> <span class="hljs-keyword">do</span> |vb|&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;vb.name = <span class="hljs-string">"Agent1"</span>&nbsp;
&nbsp;&nbsp;<span class="hljs-keyword">end</span></b>&nbsp;
<span class="hljs-keyword">end</span></code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Attention à ne pas utiliser
un nom qui serait déjà affecté à une
machine virtuelle, ce qui provoquerait une erreur. Si l’option ci-dessus
n’est pas utilisée, Vagrant produit un nom complexe de
machine qui garantit statistiquement son unicité, sacrifiant
par contre la lisibilité et l’esthétique.</p>
            </div>
          </div>
          <p class="defaut">Cette manipulation est l’occasion de souligner
que nous utilisons le fournisseur de machines virtuelles VirtualBox,
soit le mode de fonctionnement par défaut de Vagrant. Il
est toutefois possible d’utiliser d’autres fournisseurs&nbsp;: Vagrant
peut piloter la plupart des hyperviseurs connus.</p>
          <p class="defaut">Toujours pour faciliter l’identification de
la machine à n’importe quel niveau, nous affecterons&nbsp;le
nom <span class="courier11">Agent1</span> également au
nom d’hôte du système de la machine virtuelle,&nbsp;par
l’ajout de l’option ci-dessous&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet"><span class="hljs-meta"># -*- mode: ruby -*-&nbsp;</span>
<span class="hljs-meta"># vi: set ft=ruby :&nbsp;</span>
&nbsp;
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> |config|&nbsp;
&nbsp;&nbsp;config.vm.box = <span class="hljs-string">"ubuntu/xenial64"</span><b>&nbsp;
&nbsp;&nbsp;config.vm.network <span class="hljs-string">"public_network"</span>&nbsp;
&nbsp;&nbsp;config.vm.provider <span class="hljs-string">"virtualbox"</span> <span class="hljs-keyword">do</span> |vb|&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;vb.name = <span class="hljs-string">"Agent1"</span>&nbsp;
&nbsp;&nbsp;<span class="hljs-keyword">end</span>&nbsp;
&nbsp;&nbsp;config.vm.hostname = <span class="hljs-string">"Agent1"</span></b>&nbsp;
<span class="hljs-keyword">end</span></code></pre>
          <p class="defaut">Le fichier étant prêt, nous
pouvons lancer la machine Vagrant ainsi paramétrée,
en nous plaçant dans le répertoire <span class="courier11">Agent1</span> et en lançant la commande adéquate.</p>
          <p><span class="bridgehead_niv4">Démarrer une machine Vagrant</span></p>
          <pre class="literallayout"><code class="hljs">vagrant up</code></pre>
          <p class="defaut">Le premier lancement d’une machine utilisant
une nouvelle image virtuelle de base (dans notre cas <span class="courier11">Ubuntu/xenial64</span>) entraîne
le téléchargement de celle-ci, ce qui peut prendre
un certain temps, en fonction de votre connexion internet. Comme
cela sera constaté plus bas, les créations suivantes
de machines sur la même image de système&nbsp;d’exploitation
iront bien plus vite.</p>
          <p class="defaut">L’affichage qui découle de la commande
est le suivant (il peut bien sûr changer légèrement
selon le contexte)&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet">D:\Virtual\Vagrant\Agent1&gt;vagrant up&nbsp;
Bringing machine ’<span class="hljs-keyword">default</span>’ up <span class="hljs-keyword">with</span> ’virtualbox’ provider...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Importing base box ’ubuntu/xenial64’...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Matching MAC address <span class="hljs-keyword">for</span> NAT networking...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Checking <span class="hljs-keyword">if</span> box ’ubuntu/xenial64’ <span class="hljs-keyword">is</span> up <span class="hljs-keyword">to</span> <span class="hljs-built_in">date</span>...<b>&nbsp;
==&gt; <span class="hljs-keyword">default</span>: A newer version <span class="hljs-keyword">of</span> the box ’ubuntu/xenial64’ <span class="hljs-keyword">is</span> available! &nbsp;
You currently&nbsp;
==&gt; <span class="hljs-keyword">default</span>: have version ’<span class="hljs-number">20161109.1</span><span class="hljs-number">.0</span>’. The latest <span class="hljs-keyword">is</span> version &nbsp;
’<span class="hljs-number">20161119.0</span><span class="hljs-number">.0</span>’. Run&nbsp;
==&gt; <span class="hljs-keyword">default</span>: `vagrant box update` <span class="hljs-keyword">to</span> update.</b>&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Setting the name <span class="hljs-keyword">of</span> the VM: Agent1&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Clearing any previously <span class="hljs-keyword">set</span> network interfaces...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Preparing network interfaces based <span class="hljs-keyword">on</span> configuration...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Adapter <span class="hljs-number">1</span>: nat&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Adapter <span class="hljs-number">2</span>: bridged<b>&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Forwarding ports...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: <span class="hljs-number">22</span> (guest) =&gt; <span class="hljs-number">2222</span> (host) (adapter <span class="hljs-number">1</span>)</b>&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Running ’pre-boot’ VM customizations...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Booting VM...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Waiting <span class="hljs-keyword">for</span> machine <span class="hljs-keyword">to</span> boot. This may <span class="hljs-keyword">take</span> a few minutes...<b>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: SSH address: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">2222</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: SSH username: ubuntu&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: SSH auth method: password</b>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Warning: Remote connection disconnect. Retrying...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Warning: Authentication failure. Retrying...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Inserting generated <span class="hljs-keyword">public</span> <span class="hljs-keyword">key</span> within guest...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Removing insecure <span class="hljs-keyword">key</span> <span class="hljs-keyword">from</span> the guest <span class="hljs-keyword">if</span> it’s present...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: <span class="hljs-keyword">Key</span> inserted! Disconnecting <span class="hljs-keyword">and</span> reconnecting <span class="hljs-keyword">using</span> &nbsp;
<span class="hljs-keyword">new</span> SSH <span class="hljs-keyword">key</span>...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Machine booted <span class="hljs-keyword">and</span> ready!&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Checking <span class="hljs-keyword">for</span> guest additions <span class="hljs-keyword">in</span> VM...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: The guest additions <span class="hljs-keyword">on</span> this VM <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> match the installed &nbsp;
version <span class="hljs-keyword">of</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: VirtualBox! <span class="hljs-keyword">In</span> most cases this <span class="hljs-keyword">is</span> fine, but <span class="hljs-keyword">in</span> rare cases &nbsp;
it can&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: prevent things such <span class="hljs-keyword">as</span> <span class="hljs-keyword">shared</span> folders <span class="hljs-keyword">from</span> working properly. &nbsp;
<span class="hljs-keyword">If</span> you see&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: <span class="hljs-keyword">shared</span> folder errors, please make sure the guest additions &nbsp;
within the&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: virtual machine match the version <span class="hljs-keyword">of</span> VirtualBox you have &nbsp;
installed <span class="hljs-keyword">on</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: your host <span class="hljs-keyword">and</span> reload your VM.&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>:<b>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: Guest Additions Version: <span class="hljs-number">5.0</span><span class="hljs-number">.24</span></b>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: VirtualBox Version: <span class="hljs-number">5.1</span>&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Setting hostname...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Configuring <span class="hljs-keyword">and</span> enabling network interfaces...&nbsp;
==&gt; <span class="hljs-keyword">default</span>: Mounting <span class="hljs-keyword">shared</span> folders...&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>: /vagrant =&gt; D:/Virtual/Vagrant/Agent1</code></pre>
          <p class="defaut">Ces traces nous permettent de retirer plusieurs
informations&nbsp;:</p>
          <div class="divliste1">
            <ul class="liste1">
              <li class="liste1">
                <p class="liste1">L’état du
téléchargement de l’image (dans le cas ci-dessus,
l’image était déjà téléchargée,
mais il existait une nouvelle version plus à jour&nbsp;;
Vagrant donne la commande&nbsp;à lancer pour effectuer
la mise à jour).</p>
              </li>
              <li class="liste1">
                <p class="liste1">Le port 22 (il s’agit du numéro
standard pour le protocole SSH, permettant de piloter la machine
de manière sécurisée) est redirigé sur
le port 2222 de la machine hôte.</p>
              </li>
              <li class="liste1">
                <p class="liste1">Les informations de connexion sont
précisées&nbsp;: 127.0.0.1 est l’adresse IP
correspondant à la machine locale sur laquelle s’exécute
Vagrant, le port est bien le 2222 comme attendu, l’identifiant de
compte à utiliser sera <span class="courier11">Ubuntu</span>.</p>
              </li>
              <li class="liste1">
                <p class="liste1">Les extensions VirtualBox sont installées
sur la machine virtuelle, ce qui permet une meilleure intégration
avec la machine hôte. En particulier, elles sont utilisées
pour paramétrer un partage de répertoire dont
les détails sont également fournis dans ces mêmes
traces.</p>
              </li>
            </ul>
          </div>
          <p class="defaut">La machine étant lancée,
un coup d’œil dans l’interface de VirtualBox nous montrera
que Vagrant a pour rôle de créer la machine et
de la préparer pour nous, mais qu’il s’agit bien au final
d’une machine virtuelle comme les autres&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP98.png" title="images/02EP98.png" src="IMAGES/02EP98.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">La machine virtuelle est donc prête,
avec un Ubuntu en dernière version dessus, et ce sans avoir à passer
par une quelconque phase d’installation. C’est tout l’intérêt
de Vagrant de prendre ceci en charge pour l’utilisateur, et nous allons
voir ci-dessous que ce logiciel fait beaucoup plus encore.</p>
        </div>
        <div class="sect3" id="refTitle24">
          <h3 class="title">c. Provisionnement de Docker</h3>
          <p class="defaut">Il serait bien sûr possible d’accéder à la
machine nouvellement créée et d’installer Docker&nbsp;comme
nous le ferions habituellement, mais Vagrant permet également
de préparer le contenu de la machine (on parle de "provisionner") avec
des logiciels ou des scripts à exécuter pour que
la machine soit dans le bon état lors de son démarrage.
Le fait d’insérer la commande dans le script Vagrant est
une garantie de pouvoir redéployer facilement une machine
dans un état strictement identique en cas d’incident. Le
risque d’oubli ou de modification d’une commande exécutée
manuellement est dans certains cas rédhibitoire.</p>
          <p class="defaut">Dans notre cas, il serait utile que Docker
soit installé sur la machine, et nous allons donc procéder à un
ajout dans le fichier <span class="courier11">Vagrantfile</span>&nbsp;:</p>
          <pre class="programlisting"><code class="hljs vbnet">&nbsp;&nbsp;config.vm.provision <span class="hljs-string">"docker"</span> <span class="hljs-keyword">do</span> |d|&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;d.pull_images <span class="hljs-string">"busybox"</span>&nbsp;
&nbsp;&nbsp;<span class="hljs-keyword">end</span></code></pre>
          <p class="defaut">Le fait de rajouter ces lignes va permettre
non seulement l’installation de Docker dans la machine virtuelle
lors de l’instanciation de celle-ci, mais également l’exécution
de commandes Docker juste après. Pour illustrer ceci, l’exemple
ci-dessus procède au téléchargement&nbsp;de
l’image Docker <span class="courier11">busybox</span> (ce qui,
au passage, permet de valider que la machine virtuelle a bien accès à Docker
Hub).</p>
          <p class="defaut">Si le fichier contenait les instructions de
provisionnement avant la création de la machine,&nbsp;celles-ci
seront exécutées lors du démarrage. Par
contre, si les instructions ont été rajoutées
après, alors que la machine virtuelle a déjà été construite,
alors il conviendra d’utiliser la commande suivante pour forcer
le "provisionning", c’est-à-dire la préparation
automatisée de tout son contenu au-delà de l’image
du système d’exploitation&nbsp;servant de base&nbsp;:</p>
          <p><span class="bridgehead_niv4">Provisionner une machine Vagrant</span></p>
          <pre class="literallayout"><code class="hljs">vagrant provision</code></pre>
        </div>
        <div class="sect3" id="refTitle25">
          <h3 class="title">d. Aménagement de l’accès à la
machine</h3>
          <p class="defaut">À ce stade, la machine virtuelle
est considérée comme lancée et correctement provisionnée.
Il convient maintenant de montrer comment y accéder. Dans les
logs de lancement précédemment illustrés,
les instructions ont été fournies, à savoir - dans
notre cas - un accès SSH sur le port 2222. Nous
allons nous servir de ces informations pour accéder à la
machine virtuelle depuis la machine physique qui lui sert d’hôte.</p>
          <p class="defaut">Avant de passer à la connexion proprement
dite, il est nécessaire sous Windows de transformer la
clé privée de connexion qui a automatiquement été générée
par&nbsp;Vagrant pour que le logiciel PuTTY puisse l’utiliser.
Pour cela, nous utilisons PuTTYgen.&nbsp;</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Le choix de montrer les manipulations
sous Windows a été fait afin de couvrir au mieux
les deux mondes Linux et Windows. Les technologies montrées,
et en particulier Docker, fonctionnant nativement sous Linux, il
sera simple pour un utilisateur Linux de trouver les commandes équivalentes
(par exemple, PuTTY sera remplacé par la commande <span class="courier11">ssh</span>), l’inverse n’étant par
contre pas toujours vrai.</p>
            </div>
          </div>
          <p class="defaut">À noter que Windows propose le démarrage
de PuTTYgen depuis l’icône de PuTTY lorsque celui-ci est
intégré à la barre des tâches&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP99.png" title="images/02EP99.png" src="IMAGES/02EP99.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Une fois lancé, le logiciel PuTTYgen
affiche une interface comme suit&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP100.png" title="images/02EP100.png" src="IMAGES/02EP100.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur le bouton <b>Load</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans la fenêtre de sélection
de fichiers qui apparaît alors, placez-vous dans le répertoire
contenant le fichier <span class="courier11">Vagrantfile</span> utilisé précédemment.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Accédez au sous-répertoire <span class="courier11">.vagrant</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Puis placez-vous dans le sous-répertoire <span class="courier11">machines</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Puis dans <span class="courier11">default</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Et enfin, dans <span class="courier11">virtualbox</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Changez le type de fichiers à rechercher
avec la boîte de sélection tout en bas à droite,
de façon à afficher tous les fichiers, et pas
seulement ceux utilisant l’extension <span class="courier11">.ppk</span> (c’est
l’extension d’une clé sous Windows, que nous allons justement
générer).&nbsp;</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Sélectionnez le fichier <span class="courier11">private_key.</span></p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur le bouton <b>Ouvrir</b>.</p>
          </div>
          <p class="defaut">PuTTYgen indique alors une information sur
le succès d’import de la clé, ainsi qu’un indice
sur la prochaine commande à exécuter&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP101.png" title="images/02EP101.png" src="IMAGES/02EP101.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>OK</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>De retour dans l’interface principale, cliquez
sur le bouton <b>Save private key</b>.</p>
          </div>
          <p class="defaut">Le logiciel nous prévient que nous
n’avons pas spécifié de mot de passe pour protéger
la clé&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP102.png" title="images/02EP102.png" src="IMAGES/02EP102.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Nous n’en utiliserons pas dans les manipulations
expliquées dans le présent livre, pour des raisons
de simplicité&nbsp;; cependant, dans un contexte de
production, il est fortement recommandé pour des raisons
de sécurité de ne pas laisser une clé privée
sans protection, et par la même occasion de ne pas la stocker dans
un répertoire lui-même non protégé.</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Oui</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Vérifiez que vous vous trouvez dans
le même répertoire que celui où vous avez
trouvé le fichier <span class="courier11">private_key</span> (ce
devrait être le cas par défaut).</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Entrez le nom du fichier dans lequel vous allez
sauvegarder la clé privée sous une forme reconnaissable
par PuTTY, par exemple <span class="courier11">privatekey.ppk</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Enregistrer</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Fermez le logiciel PuTTYgen.</p>
          </div>
          <p class="defaut">Le fichier étant au bon format, nous
pouvons passer à l’étape de connexion à la
machine Vagrant préalablement démarrée.</p>
        </div>
        <div class="sect3" id="refTitle26">
          <h3 class="title">e. Connexion à la machine provisionnée</h3>
          <p class="defaut">Nous utiliserons le logiciel PuTTY pour accéder
en SSH à la machine depuis un système&nbsp;Windows.</p>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Les logiciels PuTTY et PuTTYgen sont
très faciles à trouver et à installer,
nous ne montrons pas ces manipulations simples.</p>
            </div>
          </div>
          <p class="defaut">Afin de faciliter la connexion, nous allons
paramétrer tout ce qui est nécessaire pour pouvoir
se connecter par quelques clics de souris seulement.</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Lancez le logiciel PuTTY.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans la fenêtre qui s’affiche, entrez <span class="courier11">127.0.0.1</span> dans la zone de saisie libellée <b>Host Name (or IP address)</b>.</p>
          </div>
          <p class="defaut">Il peut sembler étrange d’utiliser
l’adresse IP "loopback" pointant sur la machine locale, mais pour
rappel, Vagrant a établi une redirection de port entre le
port SSH (numéro 22) de la machine Vagrant et le port 2222
de la machine hôte. Nous pointons donc bien sur cette dernière.
Par contre, il faut bien sûr ajuster le port pour que la
connexion fonctionne&nbsp;:</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Entrez la valeur <span class="courier11">2222</span> dans
la zone de texte intitulée <b>Port</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>En utilisant l’arborescence d’options sur le
côté gauche, placez-vous dans la rubrique <b>Data</b> à l’intérieur
du groupe <b>Connection</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans la zone <b>Auto-login username</b>,
entrez la valeur <span class="courier11">Ubuntu</span>. Là aussi,
il s’agit d’une valeur signalée dans les logs de lancement
de la commande <span class="courier11">vagrant</span> up effectuée&nbsp;précédemment.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Déroulez la sous-catégorie <b>SSH</b> à l’intérieur
de la rubrique <b>Connection</b>, et placez-vous
dans le groupe <b>Auth</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur le bouton <b>Browse</b> en
bas à droite de l’interface.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Dans la fenêtre qui s’affiche, sélectionnez
le fichier <span class="courier11">privatekey.ppk</span> que nous
avons généré dans la section précédente à l’aide
de PuTTYgen.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Ouvrir</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Retournez dans la première rubrique, à savoir <b>Session</b>.</p>
          </div>
          <p class="defaut">L’affichage devrait être comme suit&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP103.png" title="images/02EP103.png" src="IMAGES/02EP103.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Afin de ne pas avoir à reproduire
ce paramétrage lors d’une prochaine connexion, il est possible
de le sauvegarder dans ce que PuTTY appelle une session&nbsp;:</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Saisissez un nom dans la zone de texte intitulée <b>Saved Sessions</b>. Un bon choix est par
exemple de reprendre le nom de la machine Vagrant créée, à savoir
dans notre exemple <span class="courier11">Agent1</span>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur le bouton <b>Save</b>.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Le texte <span class="courier11">Agent1</span> apparaît
alors dans la liste sous la zone de saisie, comme on peut le voir
ci-dessus, accompagné d’autres exemples.</p>
          </div>
          <p class="defaut">Vous pouvez alors lancer la session, mais
afin de bien percevoir l’intérêt des sessions
s’il n’est pas déjà clair, la manipulation suivante
est proposée&nbsp;:</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Fermez PuTTY.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Relancez-le.</p>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Double cliquez sur <b>Agent1</b> dans
la liste des sessions sauvegardées.</p>
          </div>
          <p class="defaut">La connexion à la machine Vagrant
se lance. Lors du premier accès, ou si des informations
de clé changent, PuTTY vous demandera de valider que ceci
est bien normal et maîtrisé, et pas dû à une
attaque sur vos machines&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP104.png" title="images/02EP104.png" src="IMAGES/02EP104.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Cliquez sur <b>Oui</b>.</p>
          </div>
          <p class="defaut">Une fenêtre apparaît alors
avec une interface texte qui va nous permettre de piloter la machine
virtuelle générée par l’intermédiaire
de Vagrant. Une commande qui tombe sous le sens est de vérifier
que Docker a effectivement bien été provisionné&nbsp;:</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Entrez la commande <span class="courier11">docker
version</span> et validez par la touche [Entrée].</p>
          </div>
          <p class="defaut">L’interface renvoie alors les informations
demandées. Au moment de l’écriture du présent&nbsp;ouvrage,
les versions étaient les suivantes&nbsp;:</p>
          <div class="image">
            <div class="mediaobject"><img class="imagedata picturebox" alt="images/02EP105.png" title="images/02EP105.png" src="IMAGES/02EP105.png?id=AAEAAAD%2f%2f%2f%2f%2fAQAAAAAAAAAMAgAAAE1FbmkuRWRpdGlvbnMuTWVkaWFwbHVzLCBWZXJzaW9uPTEuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49bnVsbAUBAAAAJ0VuaS5FZGl0aW9ucy5NZWRpYXBsdXMuQ29tbW9uLldhdGVybWFyawIAAAAHcGlzVGV4dAlwaWR0ZURhdGUBAA0CAAAABgMAAAAyTGF2b2NvIEVuem8gLSBiNGFhNGUzYy01ODBkLTQyNWQtOWMwOC1mNDBjMjRlNTY0ZmOPrBsoy7jYiAs%3d"></div>
          </div>
          <p class="defaut">Il est intéressant de constater que
ces versions sont récentes. La façon dont Vagrant
provisionne Docker est donc à jour par rapport aux versions
disponibles, ce qui est une bonne surprise, car les paquetages prennent
parfois du temps à être mis à jour. Nous
disposons donc d’une machine avec Docker 1.12 installé,
ce qui est, comme expliqué en début de chapitre,
un prérequis à la mise en œuvre du mode
Swarm.</p>
          <div class="manip">
            <p><span class="icon-manip">&nbsp;</span>Sortez de la session SSH en entrant la commande <span class="courier11">exit</span>.</p>
          </div>
        </div>
        <div class="sect3" id="refTitle27">
          <h3 class="title">f. Poursuite des opérations Vagrant</h3>
          <p class="defaut">Pour les exercices de mise en réseau
de Docker, plusieurs machines seront bien sûr utilisées.
Jusqu’à maintenant, l’exemple a été déroulé pour
une machine virtuelle nommée <span class="courier11">Agent1</span>.
Nous laissons le soin au lecteur de reproduire la même
manipulation avec une seconde machine nommée <span class="courier11">Agent2</span> ainsi qu’une troisième
nommée <span class="courier11">Manager</span>.</p>
          <p class="defaut">Il serait possible pour cette manipulation
de se servir d’un seul fichier Vagrantfile, mais cette opération
un peu plus complexe de Vagrant ne rentre pas dans le cadre du présent
ouvrage. Nous renvoyons le lecteur à la documentation adaptée
s’il souhaite tester ce mode de fonctionnement, et notons juste
au passage que c’est justement ce mode multi-machine qui permet
de faire varier le texte <span class="courier11">Default</span> qui
apparaissait dans toutes les traces d’exécution Vagrant. Ceci
explique pourquoi le fait de modifier le nom de la machine Vagrant
ne se reflétait pas dans les traces.</p>
          <p class="defaut">Si le besoin de supprimer une machine Vagrant
se fait ressentir lors des manipulations, la commande suivante sera
utilisée&nbsp;:</p>
          <p><span class="bridgehead_niv4">Supprimer complètement une machine
Vagrant</span></p>
          <pre class="literallayout"><code class="hljs">vagrant destroy</code></pre>
          <div class="note">
            <div class="remarkimg"><span class="icon-note"></span></div>
            <div class="divinline">
              <p class="remarque">Lorsque vous avez terminé votre
session de travail, il est recommandé d’éteindre
correctement&nbsp;les machines virtuelles avec la commande <span class="courier11">vagrant halt</span>, afin de ne pas risquer
de perte de données.</p>
            </div>
          </div>
          <p class="page"></p>
        </div>
      </div>
    </div></div></div></div></app-page-content><!----><!----><!----></div></kendo-pdf-export>